<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Demostrating network-based optimal facility location modeling &#8212; spaghetti v1.7.6 Manual</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css?v=9afac83c" />
    <link rel="stylesheet" type="text/css" href="../_static/pysal-styles.css?v=4849bb1c" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <script src="../_static/documentation_options.js?v=6cfcd222"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"TeX": {"equationNumbers": {"autoNumber": "AMS", "useLabelIds": true}}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="icon" href="../_static/pysal_favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Transportation Problem" href="transportation-problem.html" />
    <link rel="prev" title="Network-constrained spatial autocorrelation" href="network-spatial-autocorrelation.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          spaghetti</a>
        <span class="navbar-text navbar-version pull-left"><b>1.7.6</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../installation.html">Installation</a></li>
                <li><a href="../tutorials.html">Tutorials</a></li>
                <li><a href="../api.html">API</a></li>
                <li><a href="../references.html">References</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#installing-with-conda-via-spaghetti-feedstock-highly-recommended">Installing with <code class="docutils literal notranslate"><span class="pre">conda</span></code> via spaghetti-feedstock (highly recommended)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#installing-with-python-package-index">Installing with Python Package Index</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#development-version">Development Version</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="pointpattern-attributes.html">Network point pattern attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="connected-components.html">Connected components in a spatial network</a></li>
<li class="toctree-l2"><a class="reference internal" href="shortest-path-visualization.html">Generating regular lattices and visualizing shortest paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="network-segmentation.html">Spatial network segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="network-spatial-dependence.html">Network-constrained spatial dependence</a></li>
<li class="toctree-l2"><a class="reference internal" href="network-spatial-weights.html">Network spatial weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="spanning-trees.html">Network spanning trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="caveats.html">Caveats</a></li>
<li class="toctree-l2"><a class="reference internal" href="network-spatial-autocorrelation.html">Network-constrained spatial autocorrelation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Demostrating network-based optimal facility location modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="transportation-problem.html">The Transportation Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="tsp.html">The Traveling Sales(man)(person) Problem — TSP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api.html#network-feature-instantiation">Network feature instantiation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#network-feature-extraction-and-creation">Network feature extraction and creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#save-and-load-a-network">Save and load a network</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Demostrating network-based optimal facility location modeling</a><ul>
<li><a class="reference internal" href="#Integrating-pysal/spaghetti-with-Cbc-and-ortools">Integrating <code class="docutils literal notranslate"><span class="pre">pysal/spaghetti</span></code> with Cbc and ortools</a></li>
<li><a class="reference internal" href="#Update:-``pysal/spopt``-now-has-a-``locate``-module-for-optimal-facility-location-modeling.-See-more-here"><em>Update: ``pysal/spopt`` now has a ``locate`` module for optimal facility location modeling. See more</em> here</a></li>
<li><a class="reference internal" href="#1.1-Scenario:">1.1 Scenario:</a></li>
<li><a class="reference internal" href="#1.2-Set-parameters-as-per-the-scenario-layed-out-above">1.2 Set parameters as per the scenario layed out above</a></li>
<li><a class="reference internal" href="#1.3.-Define-a-class-and-functions-for-solving-the-models-and-analyzing-the-results">1.3. Define a class and functions for solving the models and analyzing the results</a><ul>
<li><a class="reference internal" href="#Utilizing-libpysal.cg.alpha_shapes">Utilizing libpysal.cg.alpha_shapes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#2.-Instantiate-a-network,-snap-points-to-the-nework,-and-calculate-cost-matrix">2. Instantiate a network, snap points to the nework, and calculate cost matrix</a><ul>
<li><a class="reference internal" href="#In-this-example-we-will-use-an-emprical-network-and-synthetic,-randomly-generated-points">In this example we will use an emprical network and synthetic, randomly generated points</a></li>
</ul>
</li>
<li><a class="reference internal" href="#2.1-Streets-as-empirical-data">2.1 Streets as empirical data</a></li>
<li><a class="reference internal" href="#2.2.-Generate-synthetic,-random-%22houses%22-near-the-network">2.2. Generate synthetic, random “houses” near the network</a></li>
<li><a class="reference internal" href="#2.3-Synthetic-client-demand-(weights)">2.3 Synthetic client demand (weights)</a></li>
<li><a class="reference internal" href="#2.4-Create-a-network-instance">2.4 Create a network instance</a></li>
<li><a class="reference internal" href="#2.5-Snap-points-to-the-network-and-fetch-their-dataframes">2.5 Snap points to the network and fetch their dataframes</a></li>
<li><a class="reference internal" href="#2.6-Calculate-distance-matrix-from-all-clients-to-all-candidate-facilities">2.6 Calculate distance matrix from all clients to all candidate facilities</a></li>
<li><a class="reference internal" href="#3.-Optimal-Facility-Location">3. Optimal Facility Location</a></li>
<li><a class="reference internal" href="#3.1-Location-Set-Covering-Problem">3.1 Location Set Covering Problem</a></li>
<li><a class="reference internal" href="#3.2-p-median-Problem">3.2 <em>p</em>-median Problem</a></li>
<li><a class="reference internal" href="#3.3-p-center-Problem">3.3 <em>p</em>-center Problem</a></li>
<li><a class="reference internal" href="#3.4-Maximal-Covering-Location-Problem">3.4 Maximal Covering Location Problem</a></li>
<li><a class="reference internal" href="#3.5-Solved-models-objects">3.5 Solved models objects</a></li>
<li><a class="reference internal" href="#3.6-Distance-analytics-matrix">3.6 Distance analytics matrix</a></li>
<li><a class="reference internal" href="#3.7-Selection-matrix">3.7 Selection matrix</a></li>
<li><a class="reference internal" href="#3.8-Plot-all-solutions-for-a-spatial-comparision">3.8 Plot all solutions for a spatial comparision</a></li>
<li><a class="reference internal" href="#3.9-Dr.-Minimax-recommendation:">3.9 Dr. Minimax recommendation:</a></li>
<li><a class="reference internal" href="#Which-model-do-you-think-would-suit-the-community's-needs-best?">Which model do you think would suit the community’s needs best?</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="admonition note">
<p>This page was generated from <a class="reference external" href="https://github.com/pysal/spaghetti/blob/main/notebooks/facility-location.ipynb">notebooks/facility-location.ipynb</a>.
Interactive online version:
<span class="raw-html"><a href="https://mybinder.org/v2/gh/pysal/spaghetti/main?filepath=notebooks/facility-location.ipynb"><img alt="Binder badge" src="https://mybinder.org/badge_logo.svg" style="vertical-align:text-bottom"></a></span></p>
</div>
<hr class="docutils" />
<p><strong>If any part of this notebook is used in your research, please cite with the reference found in</strong> <a class="reference external" href="https://github.com/pysal/spaghetti#bibtex-citation">README.md</a><strong>.</strong></p>
<hr class="docutils" />
<section id="Demostrating-network-based-optimal-facility-location-modeling">
<h1>Demostrating network-based optimal facility location modeling<a class="headerlink" href="#Demostrating-network-based-optimal-facility-location-modeling" title="Link to this heading">¶</a></h1>
<section id="Integrating-pysal/spaghetti-with-Cbc-and-ortools">
<h2>Integrating <code class="docutils literal notranslate"><span class="pre">pysal/spaghetti</span></code> with <a class="reference external" href="https://projects.coin-or.org/Cbc">Cbc</a> and <a class="reference external" href="https://developers.google.com/optimization/">ortools</a><a class="headerlink" href="#Integrating-pysal/spaghetti-with-Cbc-and-ortools" title="Link to this heading">¶</a></h2>
</section>
<section id="Update:-``pysal/spopt``-now-has-a-``locate``-module-for-optimal-facility-location-modeling.-See-more-here">
<h2><em>Update: ``pysal/spopt`` now has a ``locate`` module for optimal facility location modeling. See more</em> <a class="reference external" href="https://pysal.org/spopt/notebooks/facloc-real-world.html">here</a><a class="headerlink" href="#Update:-``pysal/spopt``-now-has-a-``locate``-module-for-optimal-facility-location-modeling.-See-more-here" title="Link to this heading">¶</a></h2>
<p><strong>Author: James D. Gaboardi</strong> <a class="reference external" href="mailto:jgaboardi&#37;&#52;&#48;gmail&#46;com">jgaboardi<span>&#64;</span>gmail<span>&#46;</span>com</a></p>
<p><strong>This notebook provides a use case for:</strong></p>
<ol class="arabic simple">
<li><p>Introducing four fundamental optimal facility location models</p></li>
<li><p>Utilizing the data structures provided by <code class="docutils literal notranslate"><span class="pre">spaghetti</span></code> as input for optimization problems</p></li>
<li><p>Solving the models, and comparing and visualizing the results</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &quot;retina&quot;
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> watermark
<span class="o">%</span><span class="k">watermark</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Last updated: 2022-11-01T23:07:43.485284-04:00

Python implementation: CPython
Python version       : 3.10.6
IPython version      : 8.6.0

Compiler    : Clang 13.0.1
OS          : Darwin
Release     : 22.1.0
Machine     : x86_64
Processor   : i386
CPU cores   : 8
Architecture: 64bit

</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">libpysal</span>
<span class="kn">from</span> <span class="nn">libpysal</span> <span class="kn">import</span> <span class="n">cg</span><span class="p">,</span> <span class="n">examples</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.lines</span> <span class="k">as</span> <span class="nn">mlines</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>
<span class="kn">import</span> <span class="nn">matplotlib_scalebar</span>
<span class="kn">from</span> <span class="nn">matplotlib_scalebar.scalebar</span> <span class="kn">import</span> <span class="n">ScaleBar</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">ortools</span>
<span class="kn">from</span> <span class="nn">ortools.linear_solver</span> <span class="kn">import</span> <span class="n">pywraplp</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
<span class="kn">import</span> <span class="nn">shapely</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="kn">import</span> <span class="nn">spaghetti</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="o">%</span><span class="k">watermark</span> -w
<span class="o">%</span><span class="k">watermark</span> -iv
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Watermark: 2.3.1

matplotlib_scalebar: 0.8.0
libpysal           : 4.6.2
json               : 2.0.9
sys                : 3.10.6 | packaged by conda-forge | (main, Aug 22 2022, 20:43:44) [Clang 13.0.1 ]
matplotlib         : 3.6.1
ortools            : 9.4.1874
shapely            : 1.8.5.post1
numpy              : 1.23.4
spaghetti          : 1.6.8
geopandas          : 0.12.1
seaborn            : 0.12.0

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/the-gaboardi/miniconda3/envs/py310_spgh_dev/lib/python3.10/site-packages/spaghetti/network.py:39: FutureWarning: The next major release of pysal/spaghetti (2.0.0) will drop support for all ``libpysal.cg`` geometries. This change is a first step in refactoring ``spaghetti`` that is expected to result in dramatically reduced runtimes for network instantiation and operations. Users currently requiring network and point pattern input as ``libpysal.cg`` geometries should prepare for this simply by converting to ``shapely`` geometries.
  warnings.warn(f&#34;{dep_msg}&#34;, FutureWarning)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span> <span class="k">as</span> <span class="n">md</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</section>
<section id="1.1-Scenario:">
<h2>1.1 Scenario:<a class="headerlink" href="#1.1-Scenario:" title="Link to this heading">¶</a></h2>
<p>The Neighborhood X Planning Committee has been asked by residents to set up a <a class="reference external" href="https://littlefreelibrary.org">Little Free Library</a> program to supplement the community’s growing reading needs, as 15 families just moved in bring the total household count to <strong>400</strong>. Since the neighborhood can’t afford to have a library on every corner, the committee must decide on where to locate them and how to do so in a transparent manner. There are currently <strong>14</strong> candidate sites in the neighborhood for
Little Free Libraries and the community can afford to support up to <strong>5</strong> locations, but would preferably support <strong>3</strong> locations with the extra budget going towards new books and unforseen maintenance costs. The committee also must locate all the libraries within <strong>1 km</strong> of all households, but preferably with <strong>.8km</strong>. As it turns out one of the committee members is an Operations Research professor at the local university, Dr. Minimax, and volunteers to build 4 models to optimally site the
Little Free Libraries acording to objective functions and specific sets of contraints. She puts forth 4 facility location models:</p>
<ul class="simple">
<li><p><strong>Location Set Covering Problem</strong></p>
<ul>
<li><p>Site the minimum number of facilities to cover all demand (clients) within a specified service radius.</p></li>
<li><p>Originally Published: Toregas, C. and ReVelle, Charles. 1972. Optimal Location Under Time or Distance Constraints. Papers of the Regional Science Association. 28(1):133 - 144.</p></li>
</ul>
</li>
<li><p><strong>p-median Problem</strong></p>
<ul>
<li><p>Site a predetermined number of facilities while minimizing total weighted distance.</p></li>
<li><p>Originally Published: S. L. Hakimi. 1964. Optimum Locations of Switching Centers and the Absolute Centers and Medians of a Graph. Operations Research. 12 (3):450-459.</p></li>
</ul>
</li>
<li><p><strong>p-center Problem</strong></p>
<ul>
<li><p>Site a predetermined number of facilities while minimizing the worst-case travel distance.</p></li>
<li><p>Originally Published: S. L. Hakimi. 1964. Optimum Locations of Switching Centers and the Absolute Centers and Medians of a Graph. Operations Research. 12 (3):450-459.</p></li>
</ul>
</li>
<li><p><strong>Maximal Covering Location Problem</strong></p>
<ul>
<li><p>Site a predetermined number of facilities while maximizing demand coverage within a specified service radius.</p></li>
<li><p>Originally Published: Church, R. L and C. ReVelle. 1974. The Maximal Covering Location Problem. Papers of the Regional Science Association. 32:101-18.</p></li>
</ul>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="1.2-Set-parameters-as-per-the-scenario-layed-out-above">
<h2>1.2 Set parameters as per the scenario layed out above<a class="headerlink" href="#1.2-Set-parameters-as-per-the-scenario-layed-out-above" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># n clients and n facilities</span>
<span class="n">client_count</span><span class="p">,</span> <span class="n">facility_count</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">14</span>

<span class="c1"># candidate facilites to site</span>
<span class="n">p_facilities</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># maximum coverage meters</span>
<span class="n">max_coverage</span> <span class="o">=</span> <span class="mf">1000.0</span>

<span class="c1"># minimum coverage meters</span>
<span class="n">min_coverage</span> <span class="o">=</span> <span class="mf">800.0</span>

<span class="n">random_seeds</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;client&quot;</span><span class="p">:</span> <span class="mi">3006</span><span class="p">,</span> <span class="s2">&quot;facility&quot;</span><span class="p">:</span> <span class="mi">1520</span><span class="p">}</span>

<span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Neighborhood X&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="1.3.-Define-a-class-and-functions-for-solving-the-models-and-analyzing-the-results">
<h2>1.3. Define a class and functions for solving the models and analyzing the results<a class="headerlink" href="#1.3.-Define-a-class-and-functions-for-solving-the-models-and-analyzing-the-results" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FacilityLocationModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Solve a facility location optimization model</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        Problem model name; must also be defined as a class method.</span>
<span class="sd">    cij : numpy.ndarray</span>
<span class="sd">        cost matrix from origins (index of i) to destination (index of j).</span>
<span class="sd">        Default is None.</span>
<span class="sd">    ai : numpy.ndarray</span>
<span class="sd">        Client weight vector. Default is None.</span>
<span class="sd">    s : float</span>
<span class="sd">        service radius. Default is None.</span>
<span class="sd">    p : int</span>
<span class="sd">        Density of facilities to site. Default is None.</span>
<span class="sd">    write_lp : str</span>
<span class="sd">        file name (and path) of the LP file to write out.</span>
<span class="sd">    print_sol : bool</span>
<span class="sd">        print select results. Default is True.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    build_lscp : build location set covering problem</span>
<span class="sd">    build_pmp : build p-median problem</span>
<span class="sd">    build_pcp : build p-center problem</span>
<span class="sd">    build_mclp : build maximal covering location problem</span>
<span class="sd">    add_vars : add variables to a model</span>
<span class="sd">    add_constrs : add contraints to a model</span>
<span class="sd">    add_obj : add an objective function to a model</span>
<span class="sd">    optimize : solve a model</span>
<span class="sd">    record_decisions : record optimal decision variables</span>
<span class="sd">    non_obj_vals : record non-objective values stats (eg. percent covered)</span>
<span class="sd">    print_results : print selected results</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    model : ortools.linear_solver.pywraplp.Solver</span>
<span class="sd">        proxy of &lt;Swig Object of type &#39;operations_research::MPSolver *&#39;</span>
<span class="sd">    n_cli : int</span>
<span class="sd">        total client sites</span>
<span class="sd">    r_cli : range</span>
<span class="sd">        iterable of client sites</span>
<span class="sd">    n_fac : int</span>
<span class="sd">        total candidate facility sites</span>
<span class="sd">    r_fac : range</span>
<span class="sd">        iterable of candidate facility sites</span>
<span class="sd">    aij : numpy.ndarray</span>
<span class="sd">        binary coverage matrix from cij (within s service radius)</span>
<span class="sd">    sij : numpy.ndarray</span>
<span class="sd">        demand weighted cost matrix as (ai * cij).</span>
<span class="sd">    fac_vars : dict</span>
<span class="sd">        facility decision variables</span>
<span class="sd">    cli_vars : dict</span>
<span class="sd">        client decision variables</span>
<span class="sd">    W : ortools.linear_solver.pywraplp.Variable</span>
<span class="sd">        minimized maximum variable in the p-center problem formulation</span>
<span class="sd">    lp_formulation : str</span>
<span class="sd">        linear programming formulation of the model</span>
<span class="sd">    solve_minutes : float</span>
<span class="sd">        solve time in minutes</span>
<span class="sd">    obj_val : int or float</span>
<span class="sd">        model objective value</span>
<span class="sd">    fac2cli : dict</span>
<span class="sd">        facility to client relationship lookup</span>
<span class="sd">    cli2fac : dict</span>
<span class="sd">        client to facility relationship lookup</span>
<span class="sd">    fac2iloc : dict</span>
<span class="sd">        facility to dataframe index location lookup</span>
<span class="sd">    n_cli_uncov : int</span>
<span class="sd">        count of client location outside the service radius</span>
<span class="sd">    cli2ncov : dict</span>
<span class="sd">        client to covered by count lookup</span>
<span class="sd">    ncov2ncli : dict</span>
<span class="sd">        covered by count to client count lookup</span>
<span class="sd">    mean_dist :</span>
<span class="sd">        mean distance per person to the assigned facility</span>
<span class="sd">    perc_served :</span>
<span class="sd">        percentage of weighted clients covered in `s`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ai</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cij</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_lp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">print_sol</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="c1"># Set model information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="c1"># create a solver instance</span>
        <span class="n">solver_instance</span> <span class="o">=</span> <span class="n">pywraplp</span><span class="o">.</span><span class="n">Solver</span><span class="o">.</span><span class="n">CBC_MIXED_INTEGER_PROGRAMMING</span>
        <span class="c1"># instantiate a model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">pywraplp</span><span class="o">.</span><span class="n">Solver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">solver_instance</span><span class="p">)</span>

        <span class="c1"># Set parameters and indices</span>
        <span class="c1"># facility parameter</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="c1"># client count and range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cij</span> <span class="o">=</span> <span class="n">cij</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cli</span> <span class="o">=</span> <span class="n">cij</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_cli</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cli</span><span class="p">)</span>
        <span class="c1"># facility count and range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_fac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cij</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_fac</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_fac</span><span class="p">)</span>
        <span class="c1"># demand parameter</span>
        <span class="k">if</span> <span class="n">ai</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ai</span> <span class="o">=</span> <span class="n">ai</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ai_sum</span> <span class="o">=</span> <span class="n">ai</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="c1"># weighted demand</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cij</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ai</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cli</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cij</span>
        <span class="c1"># if the model has a service radius parameter</span>
        <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">s</span>
            <span class="c1"># binary coverage matrix from cij</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aij</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cij</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aij</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cij</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># Set decision variables, constraints, and objective function</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;build_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;not a defined location model.&quot;</span><span class="p">)</span>

        <span class="c1"># solve</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">write_lp</span><span class="o">=</span><span class="n">write_lp</span><span class="p">)</span>
        <span class="c1"># records seleted decision variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">record_decisions</span><span class="p">()</span>
        <span class="c1"># record non-objective values stats (eg. percent covered)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_obj_vals</span><span class="p">()</span>
        <span class="c1"># print results</span>
        <span class="k">if</span> <span class="n">print_sol</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">print_results</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">build_lscp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Integer programming formulation of the Location Set Covering Problem.</span>
<span class="sd">        Originally Published:</span>
<span class="sd">            Toregas, C. and ReVelle, Charles. 1972.</span>
<span class="sd">            Optimal Location Under Time or Distance Constraints.</span>
<span class="sd">            Papers of the Regional Science Association. 28(1):133 - 144.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Decision Variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_vars</span><span class="p">()</span>
        <span class="c1"># Constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_constrs</span><span class="p">(</span><span class="n">constr</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># set coverage constraints</span>
        <span class="c1"># Objective Function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_obj</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">build_pmp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Integer programming formulation of the p-median Problem.</span>
<span class="sd">        Originally Published:</span>
<span class="sd">            S. L. Hakimi. 1964. Optimum Locations of Switching Centers and</span>
<span class="sd">            the Absolute Centers and Medians of a Graph. Operations Research.</span>
<span class="sd">            12 (3):450-459.</span>
<span class="sd">        Adapted from:</span>
<span class="sd">                -1-</span>
<span class="sd">            ReVelle, C.S. and Swain, R.W. 1970. Central facilities location.</span>
<span class="sd">            Geographical Analysis. 2(1), 30-42.</span>
<span class="sd">                -2-</span>
<span class="sd">            Toregas, C., Swain, R., ReVelle, C., Bergman, L. 1971. The Location</span>
<span class="sd">            of Emergency Service Facilities. Operations Research. 19 (6),</span>
<span class="sd">            1363-1373.</span>
<span class="sd">                - 3 -</span>
<span class="sd">            Daskin, M. (1995). Network and discrete location: Models, algorithms,</span>
<span class="sd">            and applications. New York: John Wiley and Sons, Inc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Decision Variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_vars</span><span class="p">()</span>
        <span class="c1"># Constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_constrs</span><span class="p">(</span><span class="n">constr</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># assignment constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_constrs</span><span class="p">(</span><span class="n">constr</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># facility constraint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_constrs</span><span class="p">(</span><span class="n">constr</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># opening constraints</span>
        <span class="c1"># Objective Function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_obj</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">build_pcp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Integer programming formulation of the p-center Problem.</span>
<span class="sd">        Originally Published:</span>
<span class="sd">            S. L. Hakimi. 1964. Optimum Locations of Switching Centers and</span>
<span class="sd">            the Absolute Centers and Medians of a Graph. Operations Research.</span>
<span class="sd">            12 (3):450-459.</span>
<span class="sd">        Adapted from:</span>
<span class="sd">            Daskin, M. (1995). Network and discrete location: Models, algorithms,</span>
<span class="sd">            and applications. New York: John Wiley and Sons, Inc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Decision Variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_vars</span><span class="p">()</span>
        <span class="c1"># Constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_constrs</span><span class="p">(</span><span class="n">constr</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># assignment constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_constrs</span><span class="p">(</span><span class="n">constr</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># facility constraint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_constrs</span><span class="p">(</span><span class="n">constr</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># opening constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_constrs</span><span class="p">(</span><span class="n">constr</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># minimized maximum constraints</span>
        <span class="c1"># Objective Function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_obj</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">build_mclp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Integer programming formulation of the Maximal Covering Location Problem.</span>
<span class="sd">        Originally Published:</span>
<span class="sd">            Church, R. L and C. ReVelle. 1974. The Maximal Covering Location</span>
<span class="sd">            Problem. Papers of the Regional Science Association. 32:101-18.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Decision Variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_vars</span><span class="p">()</span>
        <span class="c1"># Constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_constrs</span><span class="p">(</span><span class="n">constr</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># facility constraint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_constrs</span><span class="p">(</span><span class="n">constr</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>  <span class="c1"># maximal coverage constraints</span>
        <span class="c1"># Objective Function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_obj</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add variables to a model.&quot;&quot;&quot;</span>
        <span class="c1"># facility decision variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fac_vars</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">IntVar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;y[</span><span class="si">%i</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="p">))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_fac</span><span class="p">}</span>
        <span class="c1"># client decision variables</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;mclp&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cli_vars</span> <span class="o">=</span> <span class="p">{</span>
                <span class="p">(</span><span class="n">i</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">IntVar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;x[</span><span class="si">%i</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_cli</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;pmp&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;pcp&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cli_vars</span> <span class="o">=</span> <span class="p">{</span>
                <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">IntVar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;x[</span><span class="si">%i</span><span class="s2">,</span><span class="si">%i</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_cli</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_fac</span>
            <span class="p">}</span>
        <span class="c1"># minimized maximum variable</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;pcp&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">NumVar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">infinity</span><span class="p">(),</span> <span class="s2">&quot;W&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_constrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constr</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Add constraints to a model.</span>
<span class="sd">        (1) set coverage constraints</span>
<span class="sd">                y1 + x2 &gt;= 1</span>
<span class="sd">                x1 + x3 &gt;= 1</span>
<span class="sd">                x2 &gt;= 1</span>
<span class="sd">        (2) assignment constraints</span>
<span class="sd">                x1_1 + x1_2 + x1_3 = 1</span>
<span class="sd">        (3) facility constraints</span>
<span class="sd">                y1 + y2 + y3 = p</span>
<span class="sd">        (4) opening constraints</span>
<span class="sd">                - x1_1 + y1 &gt;= 0</span>
<span class="sd">                - x2_1 + y1 &gt;= 0</span>
<span class="sd">                - x3_1 + y1 &gt;= 0</span>
<span class="sd">        (5) minimax constraints</span>
<span class="sd">                cost1_1*x1_1 + cost1_2*x1_2 + cost1_3*x1_3 - W &lt;= 0</span>
<span class="sd">        (6) maximal coverage constraints</span>
<span class="sd">                - x1 + y1 + y3 &gt;= 0</span>
<span class="sd">                - x2 + y4 &gt;= 0</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        constr : int {1, 2, 3, 4, 5, 6}</span>
<span class="sd">            Contraint type to add to model. See above for explanation.</span>
<span class="sd">            Default is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1 - set covering constraints</span>
        <span class="k">if</span> <span class="n">constr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_cli</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Sum</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">aij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fac_vars</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_fac</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="o">&gt;=</span> <span class="mi">1</span>
                <span class="p">)</span>
        <span class="c1"># 2 - assignment constraints</span>
        <span class="k">elif</span> <span class="n">constr</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_cli</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cli_vars</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_fac</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="p">)</span>
        <span class="c1"># 3 - facility constraint</span>
        <span class="k">elif</span> <span class="n">constr</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">fac_vars</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_fac</span><span class="p">])</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
            <span class="p">)</span>
        <span class="c1"># 4 - opening constraints</span>
        <span class="k">elif</span> <span class="n">constr</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_cli</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_fac</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fac_vars</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_vars</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># 5 - minimax constraints</span>
        <span class="k">elif</span> <span class="n">constr</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_cli</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Sum</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_vars</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_fac</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span>
                <span class="p">)</span>
        <span class="c1"># 6 - max coverage constraints</span>
        <span class="k">elif</span> <span class="n">constr</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_cli</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Sum</span><span class="p">(</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">aij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fac_vars</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_fac</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an objective function to a model.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;lscp&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">fac_vars</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_fac</span><span class="p">]))</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;pmp&quot;</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_vars</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_cli</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_fac</span>
            <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;pcp&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;mclp&quot;</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ai</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_cli</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Maximize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write_lp</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Solve the model.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        write_lp : bool</span>
<span class="sd">            write out the linear programming formulation</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_redirect_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; Write out the model in linear programming format.</span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            text : str</span>
<span class="sd">                full lp formulation in str format</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">original</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.lp&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">original</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Solve</span><span class="p">()</span>
        <span class="c1"># linear programming formulation</span>
        <span class="k">if</span> <span class="n">write_lp</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lp_formulation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ExportModelAsLpFormat</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redirect_to_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lp_formulation</span><span class="p">)</span>
        <span class="c1"># WallTime() in milliseconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solve_minutes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">WallTime</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.66667e-5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">Objective</span><span class="p">()</span><span class="o">.</span><span class="n">Value</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">record_decisions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record decision variable relationship following optimization.&quot;&quot;&quot;</span>
        <span class="c1"># facility-to-dataframe index location lookup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fac2iloc</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">():</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fac_vars</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="c1"># client-to-dataframe index location lookup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cli2iloc</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># facility-to-client lookup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fac2cli</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># record client/service relationships</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_fac</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fac_vars</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">solution_value</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">jvar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fac_vars</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fac2cli</span><span class="p">[</span><span class="n">jvar</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_cli</span><span class="p">:</span>
                    <span class="n">ivar</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;lscp&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">ivar</span> <span class="o">=</span> <span class="s2">&quot;x[</span><span class="si">%i</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">i</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">fac2cli</span><span class="p">[</span><span class="n">jvar</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ivar</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;mclp&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">solution_value</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="n">ivar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_vars</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">fac2cli</span><span class="p">[</span><span class="n">jvar</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ivar</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_vars</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">solution_value</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">ivar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_vars</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
                            <span class="n">ivar</span> <span class="o">=</span> <span class="n">ivar</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">fac2cli</span><span class="p">[</span><span class="n">jvar</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ivar</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ivar</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">cli2iloc</span><span class="p">[</span><span class="n">ivar</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>

        <span class="c1"># client-to-facility lookup</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cli2fac</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cli2iloc</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cli2fac</span><span class="p">[</span><span class="n">cv</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fac2cli</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">cv</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cli2fac</span><span class="p">[</span><span class="n">cv</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="c1"># count of uncovered clients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cli_uncov</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cli</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cli2iloc</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="c1"># clients of clients covered by n facilities</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;lscp&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;mclp&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cli2ncov</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">fs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli2fac</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cli2ncov</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="p">)</span>
            <span class="n">most_coverage</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cli2ncov</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ncov2ncli</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">cov_count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">most_coverage</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">cov_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ncov2ncli</span><span class="p">[</span><span class="n">cov_count</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_cli_uncov</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">cov_count</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cli2ncov</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ncov2ncli</span><span class="p">[</span><span class="n">cov_count</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">ncov</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli2ncov</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">ncov</span> <span class="o">&gt;=</span> <span class="n">cov_count</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ncov2ncli</span><span class="p">[</span><span class="n">cov_count</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">non_obj_vals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record non-objective values.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;pmp&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mean_dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_val</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ai_sum</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;mclp&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">perc_served</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj_val</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ai_sum</span><span class="p">))</span> <span class="o">*</span> <span class="mf">100.0</span>

    <span class="k">def</span> <span class="nf">print_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print select results.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Solve Time:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve_minutes</span><span class="p">,</span> <span class="s2">&quot;minutes&quot;</span><span class="p">)</span>

        <span class="c1"># solve time and objective value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;lscp&quot;</span><span class="p">:</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="s2">&quot;facilities needed for total coverage within a &quot;</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> meter service radius&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;pmp&quot;</span><span class="p">:</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="s2">&quot;total weighted distance with &quot;</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%i</span><span class="s2"> selected facilities&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;pcp&quot;</span><span class="p">:</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="s2">&quot;worst case distance with &quot;</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%i</span><span class="s2"> selected facilities&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;mclp&quot;</span><span class="p">:</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="s2">&quot;residents within </span><span class="si">%f</span><span class="s2"> meters of &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%i</span><span class="s2"> selected facilities&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="n">units</span> <span class="o">=</span> <span class="n">u1</span> <span class="o">+</span> <span class="n">u2</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Obj. Value:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj_val</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;pmp&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean weighted distance per&quot;</span><span class="p">,</span> <span class="s2">&quot;person: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_dist</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;mclp&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Percent of </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ai_sum</span><span class="p">,</span> <span class="s2">&quot;clients covered: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">perc_served</span>
            <span class="p">)</span>

        <span class="c1"># coverage values</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;lscp&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;mclp&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ncov</span><span class="p">,</span> <span class="n">ncli</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ncov2ncli</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">ncov</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- </span><span class="si">%i</span><span class="s2"> clients are not covered&quot;</span> <span class="o">%</span> <span class="n">ncli</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ncov</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">sp</span> <span class="o">=</span> <span class="s2">&quot;y&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sp</span> <span class="o">=</span> <span class="s2">&quot;ies&quot;</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;--- </span><span class="si">%i</span><span class="s2"> clients are covered&quot;</span> <span class="o">%</span> <span class="n">ncli</span><span class="p">,</span>
                        <span class="s2">&quot;by </span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ncov</span><span class="p">,</span>
                        <span class="s2">&quot;facilit&quot;</span> <span class="o">+</span> <span class="n">sp</span><span class="p">,</span>
                    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_results</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">cli_df</span><span class="p">,</span> <span class="n">fac_df</span><span class="p">,</span> <span class="n">print_solution</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add decision variable relationships to a dataframe.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model : ortools.linear_solver.pywraplp.Solver</span>
<span class="sd">        proxy of &lt;Swig Object of type &#39;operations_research::MPSolver *&#39;</span>
<span class="sd">    cli_df : geopandas.GeoDataFrame</span>
<span class="sd">        GeoDataFrame of client locations</span>
<span class="sd">    fac_df : geopandas.GeoDataFrame</span>
<span class="sd">        GeoDataFrame of facility locations</span>
<span class="sd">    print_solution : bool</span>
<span class="sd">        print out solution decision variables. Default is False.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cli_df : geopandas.GeoDataFrame</span>
<span class="sd">        updated client locations</span>
<span class="sd">    fac_df : geopandas.GeoDataFrame</span>
<span class="sd">        updated facility locations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">col_name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_sol&quot;</span>
    <span class="n">fillers</span> <span class="o">=</span> <span class="p">[[</span><span class="n">cli_df</span><span class="p">,</span> <span class="s2">&quot;cli2fac&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">fac_df</span><span class="p">,</span> <span class="s2">&quot;fac2cli&quot;</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">df</span><span class="p">,</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">fillers</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;dv&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>
        <span class="n">df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;closed&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">print_solution</span><span class="p">:</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="n">fac_df</span><span class="p">[</span><span class="n">fac_df</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;closed&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">selected</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">selected</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;dv&quot;</span><span class="p">],</span> <span class="s2">&quot;serving:&quot;</span><span class="p">,</span> <span class="n">selected</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">col_name</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">cli_df</span><span class="p">,</span> <span class="n">fac_df</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plotter</span><span class="p">(</span>
    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">plot_aux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">buffered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pt1_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pt2_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">plot_res</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">save_fig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Top-level scenario plotter for location analytics.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fig : matplotlib.figure.Figure</span>
<span class="sd">        complete figure to plot. Default is None.</span>
<span class="sd">    base : matplotlib.axes._subplots.AxesSubplot</span>
<span class="sd">        individual axis to plot. Default is None.</span>
<span class="sd">    plot_aux : dict</span>
<span class="sd">        model data parameters dataframes to plot keyed by</span>
<span class="sd">        descriptive names. Default is None.</span>
<span class="sd">    plot_res : dict</span>
<span class="sd">        model data results dataframes to plot keyed by</span>
<span class="sd">        descriptive names. Default is None.</span>
<span class="sd">    buffered : see</span>
<span class="sd">        buffer distance from roads segments in `plot_base`.</span>
<span class="sd">        Default is None.</span>
<span class="sd">    pt1_size : float or float</span>
<span class="sd">        size of points to plot. `pt1_size` should always be the</span>
<span class="sd">        larger between `pt2_size` and `pt1_size`. Default is None.</span>
<span class="sd">    pt2_size : float or float</span>
<span class="sd">        size of points to plot. Default is None.</span>
<span class="sd">    model : ortools.linear_solver.pywraplp.Solver</span>
<span class="sd">        proxy of &lt;Swig Object of type &#39;operations_research::MPSolver *&#39;</span>
<span class="sd">    title : str</span>
<span class="sd">        plot title. Default is None.</span>
<span class="sd">    figsize : tuple</span>
<span class="sd">        Figure size for plot. Default is (12,12).</span>
<span class="sd">    save_fig : bool</span>
<span class="sd">        Default is False.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    add_to_legend : list</span>
<span class="sd">        items to add to legend</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">for_multiplot</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fig</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">base</span><span class="p">:</span>
        <span class="n">for_multiplot</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="c1"># add title</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">for_multiplot</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span>
        <span class="n">base</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">base</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="c1"># plot non-results data</span>
    <span class="k">if</span> <span class="n">plot_aux</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">plot_aux</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;streets&quot;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;buffer&quot;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;cli_tru&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">plot_res</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_sol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;closed&quot;</span><span class="p">]</span>
                    <span class="n">psize</span> <span class="o">=</span> <span class="n">pt2_size</span> <span class="o">/</span> <span class="mf">6.0</span>
                    <span class="n">pcolor</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">n_cli</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">psize</span> <span class="o">=</span> <span class="n">pt1_size</span>
                    <span class="n">pcolor</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
                <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">psize</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">pcolor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;fac_tru&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">plot_res</span><span class="p">:</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_sol&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;closed&quot;</span><span class="p">]</span>
                    <span class="n">psize</span> <span class="o">=</span> <span class="n">pt2_size</span>
                    <span class="n">pcolor</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>
                    <span class="n">pmarker</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">n_cli</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">psize</span> <span class="o">=</span> <span class="n">pt1_size</span>
                    <span class="n">pcolor</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
                    <span class="n">pmarker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span>
                <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="n">psize</span><span class="p">,</span>
                    <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="n">pcolor</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="n">pmarker</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">n_fac</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;cli_snp&quot;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="n">pt2_size</span><span class="p">,</span>
                    <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;fac_snp&quot;</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="n">pt2_size</span><span class="p">,</span>
                    <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="n">add_to_legend</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">plot_aux</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">add_to_legend</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># plot results data</span>
    <span class="k">if</span> <span class="n">plot_res</span><span class="p">:</span>
        <span class="n">dv_colors</span> <span class="o">=</span> <span class="n">dv_colorset</span><span class="p">(</span><span class="n">plot_res</span><span class="p">[</span><span class="s2">&quot;fac_var&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dv</span><span class="p">)</span>
        <span class="c1"># facilities</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">plot_res</span><span class="p">[</span><span class="s2">&quot;fac_var&quot;</span><span class="p">][</span><span class="n">plot_res</span><span class="p">[</span><span class="s2">&quot;fac_var&quot;</span><span class="p">][</span><span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_sol&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;closed&quot;</span><span class="p">]</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dv</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="c1"># decision variable info for legend</span>
        <span class="n">dvs_to_leg</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># plot facilities</span>
        <span class="k">for</span> <span class="n">dv</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">dv</span><span class="p">:</span>
            <span class="n">fac</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">dv</span> <span class="o">==</span> <span class="n">dv</span><span class="p">]</span>
            <span class="n">fac</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
                <span class="n">markersize</span><span class="o">=</span><span class="n">pt1_size</span> <span class="o">*</span> <span class="mf">3.0</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">dv_colors</span><span class="p">[</span><span class="n">dv</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="c1"># update decision variable info with set color</span>
            <span class="n">dvs_to_leg</span><span class="p">[</span><span class="n">dv</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;facecolor&quot;</span><span class="p">:</span> <span class="n">dv_colors</span><span class="p">[</span><span class="n">dv</span><span class="p">]}</span>
        <span class="c1"># plot clients &amp; service areas</span>
        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">fac2cli</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fc</span> <span class="o">=</span> <span class="n">plot_res</span><span class="p">[</span><span class="s2">&quot;cli_var&quot;</span><span class="p">][</span><span class="n">plot_res</span><span class="p">[</span><span class="s2">&quot;cli_var&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dv</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span>
            <span class="n">fc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span>
                <span class="n">markersize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">dv_colors</span><span class="p">[</span><span class="n">f</span><span class="p">],</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># update decision variable info with set client counts</span>
            <span class="n">dvs_to_leg</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;clients&quot;</span><span class="p">:</span> <span class="n">fc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
            <span class="c1"># create service area polygon</span>
            <span class="n">service_area</span> <span class="o">=</span> <span class="n">concave_hull</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">fc</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">service_area</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">base</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">dv_colors</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dvs_to_leg</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="p">:</span>

        <span class="k">class</span> <span class="nc">_ShellModel</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Object to mimic `model` when not present.&quot;&quot;&quot;</span>

            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_aux</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n_cli</span> <span class="o">=</span> <span class="n">plot_aux</span><span class="p">[</span><span class="s2">&quot;cli_tru&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">n_fac</span> <span class="o">=</span> <span class="n">plot_aux</span><span class="p">[</span><span class="s2">&quot;fac_tru&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">_ShellModel</span><span class="p">(</span><span class="n">plot_aux</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">for_multiplot</span><span class="p">:</span>
        <span class="c1"># create legend patches</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="n">create_patches</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">for_multiplot</span><span class="o">=</span><span class="n">for_multiplot</span><span class="p">,</span>
            <span class="n">pt1_size</span><span class="o">=</span><span class="n">pt1_size</span><span class="p">,</span>
            <span class="n">pt2_size</span><span class="o">=</span><span class="n">pt2_size</span><span class="p">,</span>
            <span class="n">buffered</span><span class="o">=</span><span class="n">buffered</span><span class="p">,</span>
            <span class="n">legend_aux</span><span class="o">=</span><span class="n">add_to_legend</span><span class="p">,</span>
            <span class="n">dvs_to_leg</span><span class="o">=</span><span class="n">dvs_to_leg</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">add_legend</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">for_multiplot</span><span class="o">=</span><span class="n">for_multiplot</span><span class="p">)</span>
    <span class="n">add_north_arrow</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
    <span class="n">add_scale</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save_fig</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">)</span>

    <span class="c1"># if for a multiplot explicityly return items to add to legend</span>
    <span class="k">if</span> <span class="n">for_multiplot</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">add_to_legend</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multi_plotter</span><span class="p">(</span>
    <span class="n">models</span><span class="p">,</span>
    <span class="n">plot_aux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">plot_res</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">select</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span>
    <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;plot multiple base axes as one figure</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    models : list</span>
<span class="sd">        solved model objects</span>
<span class="sd">    select : dict</span>
<span class="sd">        facility-to-selection count lookup.</span>
<span class="sd">    shape : tuple</span>
<span class="sd">        dimension for subplot array. Default is (2,2).s</span>
<span class="sd">    plot_aux : see plotter()</span>
<span class="sd">    plot_res : see plotter()</span>
<span class="sd">    title : see plotter()</span>
<span class="sd">    figsize : see plotter()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pt1_size</span><span class="p">,</span> <span class="n">pt2_size</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">60</span>
    <span class="c1"># convert list of models to array</span>
    <span class="n">mdls</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">models</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">mdls</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mdls</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s2">&quot;row&quot;</span>
    <span class="p">)</span>
    <span class="c1"># add super title to subplot array</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.925</span><span class="p">)</span>
    <span class="c1"># create each subplot</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mdls</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mdls</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">add_to_legend</span> <span class="o">=</span> <span class="n">plotter</span><span class="p">(</span>
                <span class="n">base</span><span class="o">=</span><span class="n">axarr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                <span class="n">plot_aux</span><span class="o">=</span><span class="n">plot_aux</span><span class="p">,</span>
                <span class="n">plot_res</span><span class="o">=</span><span class="n">plot_res</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">mdls</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                <span class="n">pt1_size</span><span class="o">=</span><span class="n">pt1_size</span><span class="p">,</span>
                <span class="n">pt2_size</span><span class="o">=</span><span class="n">pt2_size</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">axarr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
    <span class="n">add_to_legend</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">add_to_legend</span><span class="p">)</span>
    <span class="c1"># decision variable color set</span>
    <span class="n">dv_colors</span> <span class="o">=</span> <span class="n">dv_colorset</span><span class="p">(</span><span class="n">plot_res</span><span class="p">[</span><span class="s2">&quot;fac_var&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dv</span><span class="p">)</span>
    <span class="n">dvs_to_leg</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="p">:</span> <span class="n">dv_colors</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">models</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">fac2cli</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
    <span class="c1"># set ordered dict of {iloc:fac_var, color, x-selected}</span>
    <span class="c1"># *** models[0] can be any of the solved models</span>
    <span class="n">dvs_to_leg</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fac2iloc</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">select</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dvs_to_leg</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">dvs_to_leg</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">dvs_to_leg</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="c1"># create legend patches</span>
    <span class="n">patches</span> <span class="o">=</span> <span class="n">create_patches</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pt1_size</span><span class="o">=</span><span class="n">pt1_size</span><span class="p">,</span>
        <span class="n">pt2_size</span><span class="o">=</span><span class="n">pt2_size</span><span class="p">,</span>
        <span class="n">legend_aux</span><span class="o">=</span><span class="n">add_to_legend</span><span class="p">,</span>
        <span class="n">dvs_to_leg</span><span class="o">=</span><span class="n">dvs_to_leg</span><span class="p">,</span>
        <span class="n">for_multiplot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">add_legend</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">for_multiplot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_north_arrow</span><span class="p">(</span><span class="n">base</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;add a north arrow to an axes</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    base : see plotter()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arw</span> <span class="o">=</span> <span class="s2">&quot;rarrow, pad=0.25&quot;</span>
    <span class="n">bbox_props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="n">arw</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
    <span class="n">base</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="mi">221200</span><span class="p">,</span>
        <span class="mi">267200</span><span class="p">,</span>
        <span class="s2">&quot;      z    &quot;</span><span class="p">,</span>
        <span class="n">bbox</span><span class="o">=</span><span class="n">bbox_props</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;large&quot;</span><span class="p">,</span>
        <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;heavy&quot;</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_scale</span><span class="p">(</span><span class="n">base</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;add a scale bar to an axes</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    base : see plotter()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scalebar</span> <span class="o">=</span> <span class="n">ScaleBar</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">)</span>
    <span class="n">base</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">scalebar</span><span class="p">)</span>
    <span class="n">base</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xticklabels</span><span class="o">=</span><span class="p">[],</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[]);</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_patches</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pt1_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pt2_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">buffered</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_aux</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dvs_to_leg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">for_multiplot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;create all patches to add to the legend.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    for_multiplot : bool</span>
<span class="sd">        for a single plot (True), or multiplot (False).</span>
<span class="sd">        Default is False.</span>
<span class="sd">    model : see plotter()</span>
<span class="sd">    pt1_size : see plotter()</span>
<span class="sd">    pt2_size : see plotter()</span>
<span class="sd">    buffered : see plotter()</span>
<span class="sd">    legend_aux : see plotter()</span>
<span class="sd">    dvs_to_leg : see plotter()</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    patches : list</span>
<span class="sd">        legend handles matching plotted items</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">pt1_size</span><span class="p">:</span>
        <span class="n">ms1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pt1_size</span><span class="p">)</span> <span class="o">/</span> <span class="mf">6.0</span>
    <span class="k">if</span> <span class="n">pt2_size</span><span class="p">:</span>
        <span class="n">ms2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pt2_size</span><span class="p">)</span> <span class="o">/</span> <span class="mf">8.0</span>
    <span class="c1"># streets -- always plot</span>
    <span class="n">strs</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Streets&quot;</span><span class="p">)</span>
    <span class="c1"># all patches to add to legend</span>
    <span class="n">patches</span> <span class="o">=</span> <span class="p">[</span><span class="n">strs</span><span class="p">]</span>
    <span class="c1"># non-results data</span>
    <span class="k">if</span> <span class="n">legend_aux</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;buffer&quot;</span> <span class="ow">in</span> <span class="n">legend_aux</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Street buffer (</span><span class="si">%s</span><span class="s2">m)&quot;</span> <span class="o">%</span> <span class="n">buffered</span>
            <span class="n">strbuff</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span>
            <span class="p">)</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strbuff</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;cli_tru&quot;</span> <span class="ow">in</span> <span class="n">legend_aux</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dvs_to_leg</span><span class="p">:</span>
                    <span class="n">pcolor</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>
                    <span class="n">msize</span> <span class="o">=</span> <span class="n">ms2</span> <span class="o">/</span> <span class="mf">3.0</span>
                    <span class="n">plabel</span> <span class="o">=</span> <span class="s2">&quot;Uncovered Households &quot;</span> <span class="o">+</span> <span class="s2">&quot;($n$=</span><span class="si">%i</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">model</span><span class="o">.</span><span class="n">n_cli_uncov</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pcolor</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
                    <span class="n">msize</span> <span class="o">=</span> <span class="n">ms1</span>
                    <span class="n">plabel</span> <span class="o">=</span> <span class="s2">&quot;Households ($n$=</span><span class="si">%i</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">model</span><span class="o">.</span><span class="n">n_cli</span>
                <span class="n">cli_tru</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                    <span class="p">[],</span>
                    <span class="p">[],</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">pcolor</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                    <span class="n">ms</span><span class="o">=</span><span class="n">msize</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">plabel</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cli_tru</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="s2">&quot;fac_tru&quot;</span> <span class="ow">in</span> <span class="n">legend_aux</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dvs_to_leg</span><span class="p">:</span>
                <span class="n">pcolor</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>
                <span class="n">msize</span> <span class="o">=</span> <span class="n">ms2</span>
                <span class="n">pmarker</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
                <span class="n">no_fac</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">n_fac</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">fac2cli</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="n">plabel</span> <span class="o">=</span> <span class="s2">&quot;Unselected Facilities ($n$=</span><span class="si">%i</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">no_fac</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pcolor</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
                <span class="n">msize</span> <span class="o">=</span> <span class="n">ms1</span>
                <span class="n">pmarker</span> <span class="o">=</span> <span class="s2">&quot;o&quot;</span>
                <span class="n">plabel</span> <span class="o">=</span> <span class="s2">&quot;Little Free Library candidates&quot;</span> <span class="o">+</span> <span class="s2">&quot;($n$=</span><span class="si">%i</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">model</span><span class="o">.</span><span class="n">n_fac</span>
            <span class="n">fac_tru</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                <span class="p">[],</span>
                <span class="p">[],</span>
                <span class="n">color</span><span class="o">=</span><span class="n">pcolor</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="n">pmarker</span><span class="p">,</span>
                <span class="n">ms</span><span class="o">=</span><span class="n">msize</span><span class="p">,</span>
                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">plabel</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fac_tru</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;cli_snp&quot;</span> <span class="ow">in</span> <span class="n">legend_aux</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Households snapped to network&quot;</span>
            <span class="n">cli_snp</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                <span class="p">[],</span>
                <span class="p">[],</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                <span class="n">ms</span><span class="o">=</span><span class="n">ms2</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cli_snp</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;fac_snp&quot;</span> <span class="ow">in</span> <span class="n">legend_aux</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;LFL candidates snapped to network&quot;</span>
            <span class="n">fac_snp</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                <span class="p">[],</span>
                <span class="p">[],</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                <span class="n">ms</span><span class="o">=</span><span class="n">ms2</span><span class="p">,</span>
                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fac_snp</span><span class="p">)</span>
    <span class="c1"># results data for single plot</span>
    <span class="k">if</span> <span class="n">dvs_to_leg</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">for_multiplot</span><span class="p">:</span>
        <span class="c1"># add facility, client, and service area patches to legend</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dvs_to_leg</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fdv_label</span> <span class="o">=</span> <span class="s2">&quot;Little Free Library </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">k</span>
            <span class="n">fdv</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                <span class="p">[],</span>
                <span class="p">[],</span>
                <span class="n">color</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;facecolor&quot;</span><span class="p">],</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
                <span class="n">ms</span><span class="o">=</span><span class="n">ms1</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">fdv_label</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">cdv_label</span> <span class="o">=</span> <span class="s2">&quot;Households served by </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">k</span> <span class="o">+</span> <span class="s2">&quot;($n$=</span><span class="si">%i</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">v</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span>
            <span class="n">cdv</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                <span class="p">[],</span>
                <span class="p">[],</span>
                <span class="n">color</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;facecolor&quot;</span><span class="p">],</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                <span class="n">ms</span><span class="o">=</span><span class="n">ms1</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">,</span>
                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">cdv_label</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">serv_label</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> service area&quot;</span> <span class="o">%</span> <span class="n">k</span>
            <span class="n">serv</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="s2">&quot;facecolor&quot;</span><span class="p">],</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">serv_label</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">fdv</span><span class="p">,</span> <span class="n">cdv</span><span class="p">,</span> <span class="n">serv</span><span class="p">])</span>
    <span class="c1"># results data for multiplot</span>
    <span class="k">if</span> <span class="n">dvs_to_leg</span> <span class="ow">and</span> <span class="n">for_multiplot</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dvs_to_leg</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fdv</span> <span class="o">=</span> <span class="n">mlines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                <span class="p">[],</span>
                <span class="p">[],</span>
                <span class="n">color</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
                <span class="n">ms</span><span class="o">=</span><span class="n">ms1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> ($n$=</span><span class="si">%i</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">patches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fdv</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">patches</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_legend</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">for_multiplot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a legend to a plot</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    patches : list</span>
<span class="sd">        legend handles matching plotted items</span>
<span class="sd">    for_multiplot : create_patches</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">for_multiplot</span><span class="p">:</span>
        <span class="n">anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.65</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">anchor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.005</span><span class="p">,</span> <span class="mf">1.016</span><span class="p">)</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">handles</span><span class="o">=</span><span class="n">patches</span><span class="p">,</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
        <span class="n">fancybox</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span>
        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="n">anchor</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;x-large&quot;</span><span class="p">,</span>
        <span class="n">labelspacing</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
        <span class="n">borderpad</span><span class="o">=</span><span class="mf">2.</span>
    <span class="p">)</span>
    <span class="n">legend</span><span class="o">.</span><span class="n">get_frame</span><span class="p">()</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dv_colorset</span><span class="p">(</span><span class="n">dvs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;decision variables color set</span>
<span class="sd">    Parameters</span>
<span class="sd">    ---------</span>
<span class="sd">    dvs : geopandas.GeoSeries</span>
<span class="sd">        facility decision variables</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dv_colors : dict</span>
<span class="sd">        decision variable to set color lookup</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dv_colors</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;fuchsia&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mediumseagreen&quot;</span><span class="p">,</span>
        <span class="s2">&quot;blueviolet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;darkslategray&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lightskyblue&quot;</span><span class="p">,</span>
        <span class="s2">&quot;saddlebrown&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cyan&quot;</span><span class="p">,</span>
        <span class="s2">&quot;darkgoldenrod&quot;</span><span class="p">,</span>
        <span class="s2">&quot;limegreen&quot;</span><span class="p">,</span>
        <span class="s2">&quot;peachpuff&quot;</span><span class="p">,</span>
        <span class="s2">&quot;coral&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mediumvioletred&quot;</span><span class="p">,</span>
        <span class="s2">&quot;darkcyan&quot;</span><span class="p">,</span>
        <span class="s2">&quot;thistle&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lavender&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">dv_colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">dv</span><span class="p">:</span> <span class="n">dv_colors</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">dv</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dvs</span><span class="p">)}</span>
    <span class="k">return</span> <span class="n">dv_colors</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_buffer</span><span class="p">(</span><span class="n">in_data</span><span class="p">,</span> <span class="n">buff</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; geopandas.GeoDataFrame should be in a meters projection.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_data : geopandas.GeoDataFrame</span>
<span class="sd">        GeoDataFrame of a shapefile representing a road network.</span>
<span class="sd">    buff : int or float</span>
<span class="sd">        Desired buffer distance. Default is 50 (meters).</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    out_data : geopandas.GeoDataFrame</span>
<span class="sd">        Single polygon of the unioned street buffers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">in_data</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span>  <span class="c1"># Buffer</span>
    <span class="n">ub</span> <span class="o">=</span> <span class="n">b1</span><span class="o">.</span><span class="n">unary_union</span>  <span class="c1"># Buffer Union</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">(</span><span class="n">ub</span><span class="p">)</span>
    <span class="n">out_data</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">in_data</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out_data</span>
</pre></div>
</div>
</div>
<section id="Utilizing-libpysal.cg.alpha_shapes">
<h3>Utilizing <a class="reference external" href="https://pysal.org/libpysal/api.html#alpha-shapes">libpysal.cg.alpha_shapes</a><a class="headerlink" href="#Utilizing-libpysal.cg.alpha_shapes" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">concave_hull</span><span class="p">(</span><span class="n">fac_df</span><span class="p">,</span> <span class="n">cli_df</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">smoother</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create `libpysal.cg.alpha_shape_auto()` object</span>
<span class="sd">    for service area representation.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fac_df : geopandas.GeoDataFrame</span>
<span class="sd">        GeoDataFrame of facility locations.</span>
<span class="sd">    cli_df : geopandas.GeoDataFrame</span>
<span class="sd">        GeoDataFrame of client locations.</span>
<span class="sd">    f : str</span>
<span class="sd">        facility decision variable name.</span>
<span class="sd">    smoother : float or int</span>
<span class="sd">        buffer (meters). Default is 10.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ccv :  geopandas.GeoDataFrame</span>
<span class="sd">        polygon representing facility service area</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># client location coordinates</span>
    <span class="n">c_array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="n">cli_df</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">pt</span><span class="p">:</span> <span class="p">[</span><span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="c1"># facility location coordinates</span>
    <span class="n">f_array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="n">fac_df</span><span class="p">[</span><span class="n">fac_df</span><span class="o">.</span><span class="n">dv</span> <span class="o">==</span> <span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">pt</span><span class="p">:</span> <span class="p">[</span><span class="n">pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pt</span><span class="o">.</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="c1"># coordinates of all location in the set</span>
    <span class="n">pts_array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">c_array</span><span class="p">,</span> <span class="n">f_array</span><span class="p">))</span>
    <span class="c1"># create alpha shape (concave hull)</span>
    <span class="n">ccv</span> <span class="o">=</span> <span class="n">cg</span><span class="o">.</span><span class="n">alpha_shape_auto</span><span class="p">(</span><span class="n">pts_array</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">ccv</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">([</span><span class="n">ccv</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">smoother</span><span class="p">)],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ccv</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">simulated_geo_points</span><span class="p">(</span><span class="n">in_data</span><span class="p">,</span> <span class="n">needed</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">to_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate synthetic spatial data points within an area.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    in_data : geopandas.GeoDataFrame</span>
<span class="sd">        A single polygon of the unioned street buffers.</span>
<span class="sd">    needed : int</span>
<span class="sd">        Number of points in the buffer. Default is 20.</span>
<span class="sd">    seed : int</span>
<span class="sd">        Seed for pseudo-random number generation. Default is 0.</span>
<span class="sd">    to_file : str</span>
<span class="sd">        File name for write out.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sim_pts : geopandas.GeoDataFrame</span>
<span class="sd">        Points within the buffer.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">geoms</span> <span class="o">=</span> <span class="n">in_data</span><span class="o">.</span><span class="n">geometry</span>
    <span class="n">area</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">in_data</span><span class="o">.</span><span class="n">total_bounds</span><span class="p">)</span>
    <span class="n">simulated_points_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">simulated_points_all</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">simulated_points_all</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">area</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">area</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">area</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">area</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">geoms</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">point</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">simulated_points_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">simulated_points_list</span><span class="p">)</span> <span class="o">==</span> <span class="n">needed</span><span class="p">:</span>
            <span class="n">simulated_points_all</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">sim_pts</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span>
        <span class="n">simulated_points_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">in_data</span><span class="o">.</span><span class="n">crs</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">to_file</span><span class="p">:</span>
        <span class="n">sim_pts</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">to_file</span> <span class="o">+</span> <span class="s2">&quot;.shp&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sim_pts</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">analytics_matrix</span><span class="p">(</span><span class="n">mdls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create stylized dataframe visualization of distance analytics.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mdls : models</span>
<span class="sd">        all modeling scenarios</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    df : geopandas.GeoDataFrame</span>
<span class="sd">        distance analytics matrix</span>
<span class="sd">    style : pandas.io.formats.style.Styler</span>
<span class="sd">        style dataframe view</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mdls</span> <span class="o">=</span> <span class="n">models</span>
    <span class="n">model_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mdls</span><span class="p">]</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;abs_min&quot;</span><span class="p">,</span> <span class="s2">&quot;abs_max&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_means&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_stds&quot;</span><span class="p">]</span>
    <span class="c1"># instantiate dataframe</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;stats&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">model_names</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
    <span class="c1"># calculate stat for each model</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mdls</span><span class="p">:</span>
        <span class="n">mins</span><span class="p">,</span> <span class="n">maxs</span><span class="p">,</span> <span class="n">stds</span><span class="p">,</span> <span class="n">means</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">fac2cli</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">cli2iloc</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cs</span><span class="p">])</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">fac2iloc</span><span class="p">[</span><span class="n">f</span><span class="p">]])</span>
            <span class="n">dists</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">cij</span><span class="p">[</span><span class="n">rows</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">col</span><span class="p">]</span>
            <span class="n">mins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">maxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
            <span class="n">stds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">std</span><span class="p">()),</span> <span class="n">means</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dists</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="c1"># fill cells</span>
        <span class="n">calcs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mins</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">maxs</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">means</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stds</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
        <span class="p">]</span>
        <span class="n">label_calc</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">calcs</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stats</span><span class="p">)}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">label_calc</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;stats&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">k</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="c1"># stylize</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">light_palette</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">style</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="n">model_names</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">style</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">selection_matrix</span><span class="p">(</span><span class="n">mdls</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;create stylized dataframe visualization of selected decision variables.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mdls : models</span>
<span class="sd">        all modeling scenarios</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    df : geopandas.GeoDataFrame</span>
<span class="sd">        variable selection matrix</span>
<span class="sd">    style : pandas.io.formats.style.Styler</span>
<span class="sd">        style dataframe view</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_highlight_membership</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;highlight set membership in pandas.DataFrame.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;background-color: limegreen&quot;</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s2">&quot;$\in$&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>

    <span class="c1"># set index and coluns in empty dataframe</span>
    <span class="n">var_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fac_vars</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">var_index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">models</span><span class="p">])</span>
    <span class="c1"># if site was selected in a model label with</span>
    <span class="c1"># latex symbol for &#39;element of a set&#39; ($\in$)</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">fac2cli</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">f</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;$\in$&quot;</span>
    <span class="c1"># label all other cells with latex ($\\notin$)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">notin$&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;$\in$&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;$\sum$&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sel</span>
        <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;$\%$&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span> <span class="o">*</span> <span class="mf">100.0</span>
    <span class="c1"># stylize</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">seaborn</span><span class="o">.</span><span class="n">light_palette</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">style</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">_highlight_membership</span><span class="p">)</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;$\sum$&quot;</span><span class="p">,</span> <span class="s2">&quot;$\%$&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">style</span>
</pre></div>
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="2.-Instantiate-a-network,-snap-points-to-the-nework,-and-calculate-cost-matrix">
<h2>2. Instantiate a network, snap points to the nework, and calculate cost matrix<a class="headerlink" href="#2.-Instantiate-a-network,-snap-points-to-the-nework,-and-calculate-cost-matrix" title="Link to this heading">¶</a></h2>
<section id="In-this-example-we-will-use-an-emprical-network-and-synthetic,-randomly-generated-points">
<h3>In this example we will use an emprical network and synthetic, randomly generated points<a class="headerlink" href="#In-this-example-we-will-use-an-emprical-network-and-synthetic,-randomly-generated-points" title="Link to this heading">¶</a></h3>
</section>
</section>
<section id="2.1-Streets-as-empirical-data">
<h2>2.1 Streets as empirical data<a class="headerlink" href="#2.1-Streets-as-empirical-data" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">streets</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">examples</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s2">&quot;streets.shp&quot;</span><span class="p">))</span>
<span class="n">streets</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="s2">&quot;esri:102649&quot;</span>
<span class="n">streets</span> <span class="o">=</span> <span class="n">streets</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;epsg:2762&quot;</span><span class="p">)</span>
<span class="n">streets</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ID</th>
      <th>Length</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>244.116229</td>
      <td>LINESTRING (222007.131 267348.711, 222007.159 ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>375.974828</td>
      <td>LINESTRING (222006.951 267549.880, 222007.131 ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.0</td>
      <td>400.353405</td>
      <td>LINESTRING (221420.428 267804.889, 221411.402 ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.0</td>
      <td>660.000000</td>
      <td>LINESTRING (220875.116 268353.388, 220803.948 ...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5.0</td>
      <td>660.000000</td>
      <td>LINESTRING (220802.426 268398.824, 220917.000 ...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><strong>Plot</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">add_to_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;streets&quot;</span><span class="p">:</span> <span class="n">streets</span><span class="p">}</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">plot_aux</span><span class="o">=</span><span class="n">add_to_plot</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_facility-location_28_0.png" class="no-scaled-link" src="../_images/notebooks_facility-location_28_0.png" style="width: 999px; height: 824px;" />
</div>
</div>
</section>
<section id="2.2.-Generate-synthetic,-random-%22houses%22-near-the-network">
<h2>2.2. Generate synthetic, random “houses” near the network<a class="headerlink" href="#2.2.-Generate-synthetic,-random-%22houses%22-near-the-network" title="Link to this heading">¶</a></h2>
<p><strong>Buffer streets</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">buff</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">streets_buffer</span> <span class="o">=</span> <span class="n">get_buffer</span><span class="p">(</span><span class="n">streets</span><span class="p">,</span> <span class="n">buff</span><span class="o">=</span><span class="n">buff</span><span class="p">)</span>
<span class="n">streets_buffer</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>POLYGON ((220490.636 266956.850, 220488.782 26...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><strong>Plot</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">add_to_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;streets&quot;</span><span class="p">:</span> <span class="n">streets</span><span class="p">,</span> <span class="s2">&quot;buffer&quot;</span><span class="p">:</span> <span class="n">streets_buffer</span><span class="p">}</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">plot_aux</span><span class="o">=</span><span class="n">add_to_plot</span><span class="p">,</span> <span class="n">buffered</span><span class="o">=</span><span class="n">buff</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_facility-location_33_0.png" class="no-scaled-link" src="../_images/notebooks_facility-location_33_0.png" style="width: 1122px; height: 824px;" />
</div>
</div>
<p><strong>Generate synthetic client points and synthetic facility points</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clients</span> <span class="o">=</span> <span class="n">simulated_geo_points</span><span class="p">(</span>
    <span class="n">streets_buffer</span><span class="p">,</span> <span class="n">needed</span><span class="o">=</span><span class="n">client_count</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">random_seeds</span><span class="p">[</span><span class="s2">&quot;client&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">facilities</span> <span class="o">=</span> <span class="n">simulated_geo_points</span><span class="p">(</span>
    <span class="n">streets_buffer</span><span class="p">,</span> <span class="n">needed</span><span class="o">=</span><span class="n">facility_count</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">random_seeds</span><span class="p">[</span><span class="s2">&quot;facility&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Add decision variables to each dataset</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clients</span><span class="p">[</span><span class="s2">&quot;dv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">client_count</span><span class="p">)]</span>
<span class="n">facilities</span><span class="p">[</span><span class="s2">&quot;dv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;y[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">facility_count</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<p><strong>Plot</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">add_to_plot</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;streets&quot;</span><span class="p">:</span> <span class="n">streets</span><span class="p">,</span>
    <span class="s2">&quot;buffer&quot;</span><span class="p">:</span> <span class="n">streets_buffer</span><span class="p">,</span>
    <span class="s2">&quot;cli_tru&quot;</span><span class="p">:</span> <span class="n">clients</span><span class="p">,</span>
    <span class="s2">&quot;fac_tru&quot;</span><span class="p">:</span> <span class="n">facilities</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">plot_aux</span><span class="o">=</span><span class="n">add_to_plot</span><span class="p">,</span> <span class="n">buffered</span><span class="o">=</span><span class="n">buff</span><span class="p">,</span> <span class="n">pt1_size</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_facility-location_39_0.png" class="no-scaled-link" src="../_images/notebooks_facility-location_39_0.png" style="width: 1291px; height: 797px;" />
</div>
</div>
</section>
<section id="2.3-Synthetic-client-demand-(weights)">
<h2>2.3 Synthetic client demand (weights)<a class="headerlink" href="#2.3-Synthetic-client-demand-(weights)" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1991</span><span class="p">)</span>
<span class="n">clients</span><span class="p">[</span><span class="s2">&quot;weights&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="p">(</span><span class="n">client_count</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">clients</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>geometry</th>
      <th>dv</th>
      <th>weights</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>POINT (220621.917 267350.429)</td>
      <td>x[0]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>POINT (220803.166 268060.603)</td>
      <td>x[1]</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2</th>
      <td>POINT (221870.782 268397.667)</td>
      <td>x[2]</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>POINT (220715.998 267148.323)</td>
      <td>x[3]</td>
      <td>6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>POINT (221330.455 267985.572)</td>
      <td>x[4]</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="2.4-Create-a-network-instance">
<h2>2.4 Create a network instance<a class="headerlink" href="#2.4-Create-a-network-instance" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ntw</span> <span class="o">=</span> <span class="n">spaghetti</span><span class="o">.</span><span class="n">Network</span><span class="p">(</span><span class="n">in_data</span><span class="o">=</span><span class="n">streets</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="2.5-Snap-points-to-the-network-and-fetch-their-dataframes">
<h2>2.5 Snap points to the network and fetch their dataframes<a class="headerlink" href="#2.5-Snap-points-to-the-network-and-fetch-their-dataframes" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ntw</span><span class="o">.</span><span class="n">snapobservations</span><span class="p">(</span><span class="n">clients</span><span class="p">,</span> <span class="s2">&quot;clients&quot;</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">clients_snapped</span> <span class="o">=</span> <span class="n">spaghetti</span><span class="o">.</span><span class="n">element_as_gdf</span><span class="p">(</span>
    <span class="n">ntw</span><span class="p">,</span> <span class="n">pp_name</span><span class="o">=</span><span class="s2">&quot;clients&quot;</span><span class="p">,</span> <span class="n">snapped</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">ntw</span><span class="o">.</span><span class="n">snapobservations</span><span class="p">(</span><span class="n">facilities</span><span class="p">,</span> <span class="s2">&quot;facilities&quot;</span><span class="p">,</span> <span class="n">attribute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">facilities_snapped</span> <span class="o">=</span> <span class="n">spaghetti</span><span class="o">.</span><span class="n">element_as_gdf</span><span class="p">(</span>
    <span class="n">ntw</span><span class="p">,</span> <span class="n">pp_name</span><span class="o">=</span><span class="s2">&quot;facilities&quot;</span><span class="p">,</span> <span class="n">snapped</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Plot</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">add_to_plot</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;streets&quot;</span><span class="p">:</span> <span class="n">streets</span><span class="p">,</span>
    <span class="s2">&quot;buffer&quot;</span><span class="p">:</span> <span class="n">streets_buffer</span><span class="p">,</span>
    <span class="s2">&quot;cli_tru&quot;</span><span class="p">:</span> <span class="n">clients</span><span class="p">,</span>
    <span class="s2">&quot;fac_tru&quot;</span><span class="p">:</span> <span class="n">facilities</span><span class="p">,</span>
    <span class="s2">&quot;cli_snp&quot;</span><span class="p">:</span> <span class="n">clients_snapped</span><span class="p">,</span>
    <span class="s2">&quot;fac_snp&quot;</span><span class="p">:</span> <span class="n">facilities_snapped</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">plotter</span><span class="p">(</span><span class="n">plot_aux</span><span class="o">=</span><span class="n">add_to_plot</span><span class="p">,</span> <span class="n">buffered</span><span class="o">=</span><span class="n">buff</span><span class="p">,</span> <span class="n">pt1_size</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">pt2_size</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_facility-location_47_0.png" class="no-scaled-link" src="../_images/notebooks_facility-location_47_0.png" style="width: 1291px; height: 797px;" />
</div>
</div>
</section>
<section id="2.6-Calculate-distance-matrix-from-all-clients-to-all-candidate-facilities">
<h2>2.6 Calculate distance matrix from all clients to all candidate facilities<a class="headerlink" href="#2.6-Calculate-distance-matrix-from-all-clients-to-all-candidate-facilities" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cost_matrix</span> <span class="o">=</span> <span class="n">ntw</span><span class="o">.</span><span class="n">allneighbordistances</span><span class="p">(</span>
    <span class="n">sourcepattern</span><span class="o">=</span><span class="n">ntw</span><span class="o">.</span><span class="n">pointpatterns</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">],</span>
    <span class="n">destpattern</span><span class="o">=</span><span class="n">ntw</span><span class="o">.</span><span class="n">pointpatterns</span><span class="p">[</span><span class="s2">&quot;facilities&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">cost_matrix</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[1471.53798107, 1283.37281477, 1703.75811678],
       [ 638.15971184,  361.05942967, 1707.02787503],
       [1407.362518  , 1081.06210671, 1157.55979158]])
</pre></div></div>
</div>
</section>
<hr class="docutils" />
<section id="3.-Optimal-Facility-Location">
<h2>3. Optimal Facility Location<a class="headerlink" href="#3.-Optimal-Facility-Location" title="Link to this heading">¶</a></h2>
</section>
<section id="3.1-Location-Set-Covering-Problem">
<h2>3.1 Location Set Covering Problem<a class="headerlink" href="#3.1-Location-Set-Covering-Problem" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lscp</span> <span class="o">=</span> <span class="n">FacilityLocationModel</span><span class="p">(</span><span class="s2">&quot;lscp&quot;</span><span class="p">,</span> <span class="n">cij</span><span class="o">=</span><span class="n">cost_matrix</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">max_coverage</span><span class="p">)</span>
<span class="n">clients</span><span class="p">,</span> <span class="n">facilities</span> <span class="o">=</span> <span class="n">add_results</span><span class="p">(</span><span class="n">lscp</span><span class="p">,</span> <span class="n">clients</span><span class="p">,</span> <span class="n">facilities</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Solve Time: 0.0017166701 minutes
Obj. Value: 4.0 facilities needed for total coverage within a 1000.000000 meter service radius
--- 0 clients are not covered
--- 400 clients are covered by 1 facility
--- 185 clients are covered by 2 facilities
--- 30 clients are covered by 3 facilities
--- 10 clients are covered by 4 facilities
</pre></div></div>
</div>
<p><strong>Plot</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aux_to_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;streets&quot;</span><span class="p">:</span> <span class="n">streets</span><span class="p">,</span> <span class="s2">&quot;fac_tru&quot;</span><span class="p">:</span> <span class="n">facilities</span><span class="p">}</span>
<span class="n">res_to_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cli_var&quot;</span><span class="p">:</span> <span class="n">clients</span><span class="p">,</span> <span class="s2">&quot;fac_var&quot;</span><span class="p">:</span> <span class="n">facilities</span><span class="p">}</span>
<span class="n">plotter</span><span class="p">(</span>
    <span class="n">plot_aux</span><span class="o">=</span><span class="n">aux_to_plot</span><span class="p">,</span>
    <span class="n">plot_res</span><span class="o">=</span><span class="n">res_to_plot</span><span class="p">,</span>
    <span class="n">pt1_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">pt2_size</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">lscp</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_facility-location_53_0.png" class="no-scaled-link" src="../_images/notebooks_facility-location_53_0.png" style="width: 1292px; height: 824px;" />
</div>
</div>
</section>
<section id="3.2-p-median-Problem">
<h2>3.2 <em>p</em>-median Problem<a class="headerlink" href="#3.2-p-median-Problem" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmp</span> <span class="o">=</span> <span class="n">FacilityLocationModel</span><span class="p">(</span>
    <span class="s2">&quot;pmp&quot;</span><span class="p">,</span> <span class="n">ai</span><span class="o">=</span><span class="n">clients</span><span class="p">[</span><span class="s2">&quot;weights&quot;</span><span class="p">],</span> <span class="n">cij</span><span class="o">=</span><span class="n">cost_matrix</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p_facilities</span>
<span class="p">)</span>
<span class="n">clients</span><span class="p">,</span> <span class="n">facilities</span> <span class="o">=</span> <span class="n">add_results</span><span class="p">(</span><span class="n">pmp</span><span class="p">,</span> <span class="n">clients</span><span class="p">,</span> <span class="n">facilities</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Solve Time: 0.011116688900000001 minutes
Obj. Value: 898921.4985990013 total weighted distance with 3 selected facilities
Mean weighted distance per person: 562.529098
</pre></div></div>
</div>
<p><strong>Plot</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aux_to_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;streets&quot;</span><span class="p">:</span> <span class="n">streets</span><span class="p">,</span> <span class="s2">&quot;fac_tru&quot;</span><span class="p">:</span> <span class="n">facilities</span><span class="p">}</span>
<span class="n">res_to_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cli_var&quot;</span><span class="p">:</span> <span class="n">clients</span><span class="p">,</span> <span class="s2">&quot;fac_var&quot;</span><span class="p">:</span> <span class="n">facilities</span><span class="p">}</span>
<span class="n">plotter</span><span class="p">(</span>
    <span class="n">plot_aux</span><span class="o">=</span><span class="n">aux_to_plot</span><span class="p">,</span>
    <span class="n">plot_res</span><span class="o">=</span><span class="n">res_to_plot</span><span class="p">,</span>
    <span class="n">pt1_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">pt2_size</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">pmp</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_facility-location_57_0.png" class="no-scaled-link" src="../_images/notebooks_facility-location_57_0.png" style="width: 1305px; height: 824px;" />
</div>
</div>
</section>
<section id="3.3-p-center-Problem">
<h2>3.3 <em>p</em>-center Problem<a class="headerlink" href="#3.3-p-center-Problem" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pcp</span> <span class="o">=</span> <span class="n">FacilityLocationModel</span><span class="p">(</span><span class="s2">&quot;pcp&quot;</span><span class="p">,</span> <span class="n">cij</span><span class="o">=</span><span class="n">cost_matrix</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p_facilities</span><span class="p">)</span>
<span class="n">clients</span><span class="p">,</span> <span class="n">facilities</span> <span class="o">=</span> <span class="n">add_results</span><span class="p">(</span><span class="n">pcp</span><span class="p">,</span> <span class="n">clients</span><span class="p">,</span> <span class="n">facilities</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Solve Time: 0.0388500777 minutes
Obj. Value: 1024.6229184980525 worst case distance with 3 selected facilities
</pre></div></div>
</div>
<p><strong>Plot</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aux_to_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;streets&quot;</span><span class="p">:</span> <span class="n">streets</span><span class="p">,</span> <span class="s2">&quot;fac_tru&quot;</span><span class="p">:</span> <span class="n">facilities</span><span class="p">}</span>
<span class="n">res_to_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cli_var&quot;</span><span class="p">:</span> <span class="n">clients</span><span class="p">,</span> <span class="s2">&quot;fac_var&quot;</span><span class="p">:</span> <span class="n">facilities</span><span class="p">}</span>
<span class="n">plotter</span><span class="p">(</span>
    <span class="n">plot_aux</span><span class="o">=</span><span class="n">aux_to_plot</span><span class="p">,</span>
    <span class="n">plot_res</span><span class="o">=</span><span class="n">res_to_plot</span><span class="p">,</span>
    <span class="n">pt1_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">pt2_size</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">pcp</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_facility-location_61_0.png" class="no-scaled-link" src="../_images/notebooks_facility-location_61_0.png" style="width: 1292px; height: 824px;" />
</div>
</div>
</section>
<section id="3.4-Maximal-Covering-Location-Problem">
<h2>3.4 Maximal Covering Location Problem<a class="headerlink" href="#3.4-Maximal-Covering-Location-Problem" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mclp</span> <span class="o">=</span> <span class="n">FacilityLocationModel</span><span class="p">(</span>
    <span class="s2">&quot;mclp&quot;</span><span class="p">,</span> <span class="n">ai</span><span class="o">=</span><span class="n">clients</span><span class="p">[</span><span class="s2">&quot;weights&quot;</span><span class="p">],</span> <span class="n">cij</span><span class="o">=</span><span class="n">cost_matrix</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p_facilities</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">min_coverage</span>
<span class="p">)</span>
<span class="n">clients</span><span class="p">,</span> <span class="n">facilities</span> <span class="o">=</span> <span class="n">add_results</span><span class="p">(</span><span class="n">mclp</span><span class="p">,</span> <span class="n">clients</span><span class="p">,</span> <span class="n">facilities</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Solve Time: 0.0022000044000000003 minutes
Obj. Value: 1312.0 residents within 800.000000 meters of 3 selected facilities
Percent of 1598 clients covered: 82.102628
--- 73 clients are not covered
--- 327 clients are covered by 1 facility
--- 17 clients are covered by 2 facilities
</pre></div></div>
</div>
<p><strong>Plot</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aux_to_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;streets&quot;</span><span class="p">:</span> <span class="n">streets</span><span class="p">,</span> <span class="s2">&quot;cli_tru&quot;</span><span class="p">:</span> <span class="n">clients</span><span class="p">,</span> <span class="s2">&quot;fac_tru&quot;</span><span class="p">:</span> <span class="n">facilities</span><span class="p">}</span>
<span class="n">res_to_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cli_var&quot;</span><span class="p">:</span> <span class="n">clients</span><span class="p">,</span> <span class="s2">&quot;fac_var&quot;</span><span class="p">:</span> <span class="n">facilities</span><span class="p">}</span>
<span class="n">plotter</span><span class="p">(</span>
    <span class="n">plot_aux</span><span class="o">=</span><span class="n">aux_to_plot</span><span class="p">,</span>
    <span class="n">plot_res</span><span class="o">=</span><span class="n">res_to_plot</span><span class="p">,</span>
    <span class="n">pt1_size</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="n">pt2_size</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">mclp</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_facility-location_65_0.png" class="no-scaled-link" src="../_images/notebooks_facility-location_65_0.png" style="width: 1309px; height: 824px;" />
</div>
</div>
</section>
<section id="3.5-Solved-models-objects">
<h2>3.5 Solved models objects<a class="headerlink" href="#3.5-Solved-models-objects" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">lscp</span><span class="p">,</span> <span class="n">pmp</span><span class="p">,</span> <span class="n">pcp</span><span class="p">,</span> <span class="n">mclp</span><span class="p">]</span>
</pre></div>
</div>
</div>
</section>
<section id="3.6-Distance-analytics-matrix">
<h2>3.6 Distance analytics matrix<a class="headerlink" href="#3.6-Distance-analytics-matrix" title="Link to this heading">¶</a></h2>
<p><span class="math notranslate nohighlight">\(\Longrightarrow\)</span> Results may vary due to the random seed being set on local machines <span class="math notranslate nohighlight">\(\Longleftarrow\)</span></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">analytics_df</span><span class="p">,</span> <span class="n">analytics_display</span> <span class="o">=</span> <span class="n">analytics_matrix</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
<span class="n">analytics_display</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style type="text/css">
#T_82b90_row0_col1, #T_82b90_row0_col2, #T_82b90_row0_col4, #T_82b90_row1_col4, #T_82b90_row2_col4, #T_82b90_row3_col4 {
  background-color: #008000;
  color: #f1f1f1;
}
#T_82b90_row0_col3, #T_82b90_row1_col2, #T_82b90_row2_col1, #T_82b90_row3_col2 {
  background-color: #ebf3eb;
  color: #000000;
}
#T_82b90_row1_col1 {
  background-color: #6eb66e;
  color: #f1f1f1;
}
#T_82b90_row1_col3 {
  background-color: #7cbd7c;
  color: #000000;
}
#T_82b90_row2_col2 {
  background-color: #6cb56c;
  color: #f1f1f1;
}
#T_82b90_row2_col3 {
  background-color: #96c996;
  color: #000000;
}
#T_82b90_row3_col1 {
  background-color: #93c893;
  color: #000000;
}
#T_82b90_row3_col3 {
  background-color: #90c790;
  color: #000000;
}
</style>
<table id="T_82b90">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_82b90_level0_col0" class="col_heading level0 col0" >stats</th>
      <th id="T_82b90_level0_col1" class="col_heading level0 col1" >lscp</th>
      <th id="T_82b90_level0_col2" class="col_heading level0 col2" >pmp</th>
      <th id="T_82b90_level0_col3" class="col_heading level0 col3" >pcp</th>
      <th id="T_82b90_level0_col4" class="col_heading level0 col4" >mclp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_82b90_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_82b90_row0_col0" class="data row0 col0" >abs_min</td>
      <td id="T_82b90_row0_col1" class="data row0 col1" >0.918980</td>
      <td id="T_82b90_row0_col2" class="data row0 col2" >0.918980</td>
      <td id="T_82b90_row0_col3" class="data row0 col3" >12.745550</td>
      <td id="T_82b90_row0_col4" class="data row0 col4" >0.918980</td>
    </tr>
    <tr>
      <th id="T_82b90_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_82b90_row1_col0" class="data row1 col0" >abs_max</td>
      <td id="T_82b90_row1_col1" class="data row1 col1" >998.528376</td>
      <td id="T_82b90_row1_col2" class="data row1 col2" >1224.279469</td>
      <td id="T_82b90_row1_col3" class="data row1 col3" >1024.622918</td>
      <td id="T_82b90_row1_col4" class="data row1 col4" >799.230211</td>
    </tr>
    <tr>
      <th id="T_82b90_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_82b90_row2_col0" class="data row2 col0" >mean_means</td>
      <td id="T_82b90_row2_col1" class="data row2 col1" >645.325840</td>
      <td id="T_82b90_row2_col2" class="data row2 col2" >565.138987</td>
      <td id="T_82b90_row2_col3" class="data row2 col3" >592.112866</td>
      <td id="T_82b90_row2_col4" class="data row2 col4" >497.518232</td>
    </tr>
    <tr>
      <th id="T_82b90_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_82b90_row3_col0" class="data row3 col0" >mean_stds</td>
      <td id="T_82b90_row3_col1" class="data row3 col1" >245.521773</td>
      <td id="T_82b90_row3_col2" class="data row3 col2" >263.800560</td>
      <td id="T_82b90_row3_col3" class="data row3 col3" >244.912853</td>
      <td id="T_82b90_row3_col4" class="data row3 col4" >214.708326</td>
    </tr>
  </tbody>
</table></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">md</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;While it appears the `</span><span class="si">{</span><span class="n">mclp</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` performs most optimally with the least distance per stastistic, we have to remember that the `</span><span class="si">{</span><span class="n">mclp</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">` is leaving `</span><span class="si">{</span><span class="n">mclp</span><span class="o">.</span><span class="n">n_cli_uncov</span><span class="si">}</span><span class="s2">` clients uncovered. Therefore, it may generally give lower maximum and average travel costs due to the uncovered client travel costs being excluded.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<p>While it appears the <code class="docutils literal notranslate"><span class="pre">mclp</span></code> performs most optimally with the least distance per stastistic, we have to remember that the <code class="docutils literal notranslate"><span class="pre">mclp</span></code> is leaving <code class="docutils literal notranslate"><span class="pre">73</span></code> clients uncovered. Therefore, it may generally give lower maximum and average travel costs due to the uncovered client travel costs being excluded.</p>
</div>
</div>
</section>
<section id="3.7-Selection-matrix">
<h2>3.7 Selection matrix<a class="headerlink" href="#3.7-Selection-matrix" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">selection_df</span><span class="p">,</span> <span class="n">selection_display</span> <span class="o">=</span> <span class="n">selection_matrix</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
<span class="n">selection_display</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style type="text/css">
#T_d7ca2_row0_col4, #T_d7ca2_row0_col5, #T_d7ca2_row2_col4, #T_d7ca2_row2_col5, #T_d7ca2_row5_col4, #T_d7ca2_row5_col5, #T_d7ca2_row7_col4, #T_d7ca2_row7_col5, #T_d7ca2_row8_col4, #T_d7ca2_row8_col5, #T_d7ca2_row10_col4, #T_d7ca2_row10_col5, #T_d7ca2_row11_col4, #T_d7ca2_row11_col5, #T_d7ca2_row13_col4, #T_d7ca2_row13_col5 {
  background-color: #ebf3eb;
  color: #000000;
}
#T_d7ca2_row1_col2, #T_d7ca2_row3_col0, #T_d7ca2_row3_col2, #T_d7ca2_row4_col0, #T_d7ca2_row4_col1, #T_d7ca2_row4_col3, #T_d7ca2_row6_col0, #T_d7ca2_row6_col1, #T_d7ca2_row6_col2, #T_d7ca2_row6_col3, #T_d7ca2_row9_col0, #T_d7ca2_row12_col1, #T_d7ca2_row12_col3 {
  background-color: limegreen;
}
#T_d7ca2_row1_col4, #T_d7ca2_row1_col5, #T_d7ca2_row9_col4, #T_d7ca2_row9_col5 {
  background-color: #b0d6b0;
  color: #000000;
}
#T_d7ca2_row3_col4, #T_d7ca2_row3_col5, #T_d7ca2_row12_col4, #T_d7ca2_row12_col5 {
  background-color: #75b975;
  color: #f1f1f1;
}
#T_d7ca2_row4_col4, #T_d7ca2_row4_col5 {
  background-color: #3a9c3a;
  color: #f1f1f1;
}
#T_d7ca2_row6_col4, #T_d7ca2_row6_col5 {
  background-color: #008000;
  color: #f1f1f1;
}
</style>
<table id="T_d7ca2">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_d7ca2_level0_col0" class="col_heading level0 col0" >lscp</th>
      <th id="T_d7ca2_level0_col1" class="col_heading level0 col1" >pmp</th>
      <th id="T_d7ca2_level0_col2" class="col_heading level0 col2" >pcp</th>
      <th id="T_d7ca2_level0_col3" class="col_heading level0 col3" >mclp</th>
      <th id="T_d7ca2_level0_col4" class="col_heading level0 col4" >$\sum$</th>
      <th id="T_d7ca2_level0_col5" class="col_heading level0 col5" >$\%$</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_d7ca2_level0_row0" class="row_heading level0 row0" >y[0]</th>
      <td id="T_d7ca2_row0_col0" class="data row0 col0" >$\notin$</td>
      <td id="T_d7ca2_row0_col1" class="data row0 col1" >$\notin$</td>
      <td id="T_d7ca2_row0_col2" class="data row0 col2" >$\notin$</td>
      <td id="T_d7ca2_row0_col3" class="data row0 col3" >$\notin$</td>
      <td id="T_d7ca2_row0_col4" class="data row0 col4" >0.000000</td>
      <td id="T_d7ca2_row0_col5" class="data row0 col5" >0.000000</td>
    </tr>
    <tr>
      <th id="T_d7ca2_level0_row1" class="row_heading level0 row1" >y[1]</th>
      <td id="T_d7ca2_row1_col0" class="data row1 col0" >$\notin$</td>
      <td id="T_d7ca2_row1_col1" class="data row1 col1" >$\notin$</td>
      <td id="T_d7ca2_row1_col2" class="data row1 col2" >$\in$</td>
      <td id="T_d7ca2_row1_col3" class="data row1 col3" >$\notin$</td>
      <td id="T_d7ca2_row1_col4" class="data row1 col4" >1.000000</td>
      <td id="T_d7ca2_row1_col5" class="data row1 col5" >25.000000</td>
    </tr>
    <tr>
      <th id="T_d7ca2_level0_row2" class="row_heading level0 row2" >y[2]</th>
      <td id="T_d7ca2_row2_col0" class="data row2 col0" >$\notin$</td>
      <td id="T_d7ca2_row2_col1" class="data row2 col1" >$\notin$</td>
      <td id="T_d7ca2_row2_col2" class="data row2 col2" >$\notin$</td>
      <td id="T_d7ca2_row2_col3" class="data row2 col3" >$\notin$</td>
      <td id="T_d7ca2_row2_col4" class="data row2 col4" >0.000000</td>
      <td id="T_d7ca2_row2_col5" class="data row2 col5" >0.000000</td>
    </tr>
    <tr>
      <th id="T_d7ca2_level0_row3" class="row_heading level0 row3" >y[3]</th>
      <td id="T_d7ca2_row3_col0" class="data row3 col0" >$\in$</td>
      <td id="T_d7ca2_row3_col1" class="data row3 col1" >$\notin$</td>
      <td id="T_d7ca2_row3_col2" class="data row3 col2" >$\in$</td>
      <td id="T_d7ca2_row3_col3" class="data row3 col3" >$\notin$</td>
      <td id="T_d7ca2_row3_col4" class="data row3 col4" >2.000000</td>
      <td id="T_d7ca2_row3_col5" class="data row3 col5" >50.000000</td>
    </tr>
    <tr>
      <th id="T_d7ca2_level0_row4" class="row_heading level0 row4" >y[4]</th>
      <td id="T_d7ca2_row4_col0" class="data row4 col0" >$\in$</td>
      <td id="T_d7ca2_row4_col1" class="data row4 col1" >$\in$</td>
      <td id="T_d7ca2_row4_col2" class="data row4 col2" >$\notin$</td>
      <td id="T_d7ca2_row4_col3" class="data row4 col3" >$\in$</td>
      <td id="T_d7ca2_row4_col4" class="data row4 col4" >3.000000</td>
      <td id="T_d7ca2_row4_col5" class="data row4 col5" >75.000000</td>
    </tr>
    <tr>
      <th id="T_d7ca2_level0_row5" class="row_heading level0 row5" >y[5]</th>
      <td id="T_d7ca2_row5_col0" class="data row5 col0" >$\notin$</td>
      <td id="T_d7ca2_row5_col1" class="data row5 col1" >$\notin$</td>
      <td id="T_d7ca2_row5_col2" class="data row5 col2" >$\notin$</td>
      <td id="T_d7ca2_row5_col3" class="data row5 col3" >$\notin$</td>
      <td id="T_d7ca2_row5_col4" class="data row5 col4" >0.000000</td>
      <td id="T_d7ca2_row5_col5" class="data row5 col5" >0.000000</td>
    </tr>
    <tr>
      <th id="T_d7ca2_level0_row6" class="row_heading level0 row6" >y[6]</th>
      <td id="T_d7ca2_row6_col0" class="data row6 col0" >$\in$</td>
      <td id="T_d7ca2_row6_col1" class="data row6 col1" >$\in$</td>
      <td id="T_d7ca2_row6_col2" class="data row6 col2" >$\in$</td>
      <td id="T_d7ca2_row6_col3" class="data row6 col3" >$\in$</td>
      <td id="T_d7ca2_row6_col4" class="data row6 col4" >4.000000</td>
      <td id="T_d7ca2_row6_col5" class="data row6 col5" >100.000000</td>
    </tr>
    <tr>
      <th id="T_d7ca2_level0_row7" class="row_heading level0 row7" >y[7]</th>
      <td id="T_d7ca2_row7_col0" class="data row7 col0" >$\notin$</td>
      <td id="T_d7ca2_row7_col1" class="data row7 col1" >$\notin$</td>
      <td id="T_d7ca2_row7_col2" class="data row7 col2" >$\notin$</td>
      <td id="T_d7ca2_row7_col3" class="data row7 col3" >$\notin$</td>
      <td id="T_d7ca2_row7_col4" class="data row7 col4" >0.000000</td>
      <td id="T_d7ca2_row7_col5" class="data row7 col5" >0.000000</td>
    </tr>
    <tr>
      <th id="T_d7ca2_level0_row8" class="row_heading level0 row8" >y[8]</th>
      <td id="T_d7ca2_row8_col0" class="data row8 col0" >$\notin$</td>
      <td id="T_d7ca2_row8_col1" class="data row8 col1" >$\notin$</td>
      <td id="T_d7ca2_row8_col2" class="data row8 col2" >$\notin$</td>
      <td id="T_d7ca2_row8_col3" class="data row8 col3" >$\notin$</td>
      <td id="T_d7ca2_row8_col4" class="data row8 col4" >0.000000</td>
      <td id="T_d7ca2_row8_col5" class="data row8 col5" >0.000000</td>
    </tr>
    <tr>
      <th id="T_d7ca2_level0_row9" class="row_heading level0 row9" >y[9]</th>
      <td id="T_d7ca2_row9_col0" class="data row9 col0" >$\in$</td>
      <td id="T_d7ca2_row9_col1" class="data row9 col1" >$\notin$</td>
      <td id="T_d7ca2_row9_col2" class="data row9 col2" >$\notin$</td>
      <td id="T_d7ca2_row9_col3" class="data row9 col3" >$\notin$</td>
      <td id="T_d7ca2_row9_col4" class="data row9 col4" >1.000000</td>
      <td id="T_d7ca2_row9_col5" class="data row9 col5" >25.000000</td>
    </tr>
    <tr>
      <th id="T_d7ca2_level0_row10" class="row_heading level0 row10" >y[10]</th>
      <td id="T_d7ca2_row10_col0" class="data row10 col0" >$\notin$</td>
      <td id="T_d7ca2_row10_col1" class="data row10 col1" >$\notin$</td>
      <td id="T_d7ca2_row10_col2" class="data row10 col2" >$\notin$</td>
      <td id="T_d7ca2_row10_col3" class="data row10 col3" >$\notin$</td>
      <td id="T_d7ca2_row10_col4" class="data row10 col4" >0.000000</td>
      <td id="T_d7ca2_row10_col5" class="data row10 col5" >0.000000</td>
    </tr>
    <tr>
      <th id="T_d7ca2_level0_row11" class="row_heading level0 row11" >y[11]</th>
      <td id="T_d7ca2_row11_col0" class="data row11 col0" >$\notin$</td>
      <td id="T_d7ca2_row11_col1" class="data row11 col1" >$\notin$</td>
      <td id="T_d7ca2_row11_col2" class="data row11 col2" >$\notin$</td>
      <td id="T_d7ca2_row11_col3" class="data row11 col3" >$\notin$</td>
      <td id="T_d7ca2_row11_col4" class="data row11 col4" >0.000000</td>
      <td id="T_d7ca2_row11_col5" class="data row11 col5" >0.000000</td>
    </tr>
    <tr>
      <th id="T_d7ca2_level0_row12" class="row_heading level0 row12" >y[12]</th>
      <td id="T_d7ca2_row12_col0" class="data row12 col0" >$\notin$</td>
      <td id="T_d7ca2_row12_col1" class="data row12 col1" >$\in$</td>
      <td id="T_d7ca2_row12_col2" class="data row12 col2" >$\notin$</td>
      <td id="T_d7ca2_row12_col3" class="data row12 col3" >$\in$</td>
      <td id="T_d7ca2_row12_col4" class="data row12 col4" >2.000000</td>
      <td id="T_d7ca2_row12_col5" class="data row12 col5" >50.000000</td>
    </tr>
    <tr>
      <th id="T_d7ca2_level0_row13" class="row_heading level0 row13" >y[13]</th>
      <td id="T_d7ca2_row13_col0" class="data row13 col0" >$\notin$</td>
      <td id="T_d7ca2_row13_col1" class="data row13 col1" >$\notin$</td>
      <td id="T_d7ca2_row13_col2" class="data row13 col2" >$\notin$</td>
      <td id="T_d7ca2_row13_col3" class="data row13 col3" >$\notin$</td>
      <td id="T_d7ca2_row13_col4" class="data row13 col4" >0.000000</td>
      <td id="T_d7ca2_row13_col5" class="data row13 col5" >0.000000</td>
    </tr>
  </tbody>
</table></div>
</div>
</section>
<section id="3.8-Plot-all-solutions-for-a-spatial-comparision">
<h2>3.8 Plot all solutions for a spatial comparision<a class="headerlink" href="#3.8-Plot-all-solutions-for-a-spatial-comparision" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">usr_warning</span> <span class="o">=</span> <span class="s2">&quot;The GeoDataFrame you are attempting to plot is empty&quot;</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">usr_warning</span><span class="p">)</span>

<span class="c1"># facility variable-to-times selected lookup</span>
<span class="n">fac2selectcount</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">selection_df</span><span class="p">[</span><span class="s2">&quot;$\sum$&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
<span class="n">aux_to_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;streets&quot;</span><span class="p">:</span> <span class="n">streets</span><span class="p">,</span> <span class="s2">&quot;cli_tru&quot;</span><span class="p">:</span> <span class="n">clients</span><span class="p">}</span>
<span class="n">res_to_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cli_var&quot;</span><span class="p">:</span> <span class="n">clients</span><span class="p">,</span> <span class="s2">&quot;fac_var&quot;</span><span class="p">:</span> <span class="n">facilities</span><span class="p">}</span>
<span class="n">multi_plotter</span><span class="p">(</span>
    <span class="n">models</span><span class="p">,</span>
    <span class="n">plot_aux</span><span class="o">=</span><span class="n">aux_to_plot</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
    <span class="n">plot_res</span><span class="o">=</span><span class="n">res_to_plot</span><span class="p">,</span>
    <span class="n">select</span><span class="o">=</span><span class="n">fac2selectcount</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_facility-location_74_0.png" class="no-scaled-link" src="../_images/notebooks_facility-location_74_0.png" style="width: 1421px; height: 1242px;" />
</div>
</div>
</section>
<section id="3.9-Dr.-Minimax-recommendation:">
<h2>3.9 Dr. Minimax recommendation:<a class="headerlink" href="#3.9-Dr.-Minimax-recommendation:" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v1</span> <span class="o">=</span> <span class="n">pcp</span><span class="o">.</span><span class="n">name</span>
<span class="n">v2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">pcp</span><span class="o">.</span><span class="n">fac2cli</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">.</span><span class="n">translate</span><span class="p">({</span><span class="nb">ord</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&#39;&quot;</span><span class="p">):</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">v3</span> <span class="o">=</span> <span class="n">analytics_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">analytics_df</span><span class="p">[</span><span class="s2">&quot;stats&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;abs_max&quot;</span><span class="p">),</span> <span class="s2">&quot;pcp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="n">v4</span> <span class="o">=</span> <span class="n">max_coverage</span>
<span class="n">md</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;* The `</span><span class="si">{</span><span class="n">v1</span><span class="si">}</span><span class="s2">` model facility configuration: `</span><span class="si">{</span><span class="n">v2</span><span class="si">}</span><span class="s2">` </span><span class="se">\n\</span>
<span class="s2">* This configuration results in an absolute maximum distance from any household to its assigned Little Free Library of `</span><span class="si">{</span><span class="n">v3</span><span class="si">}</span><span class="s2">` meters, which is slightly more than the `</span><span class="si">{</span><span class="n">v4</span><span class="si">}</span><span class="s2">` meter maximum distance stipulation put forth by the committee. Dr. Minimax believes this to be the most equitable and feasible solution for the residents of Neighbor X. However..., the Neighborhood X Planning Committee turned out to be corrupt and merely chose locations for the Little Free Libraries nearest to their respective houses....&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area docutils container">
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">pcp</span></code> model facility configuration: <code class="docutils literal notranslate"><span class="pre">[y[1],</span> <span class="pre">y[3],</span> <span class="pre">y[6]]</span></code></p></li>
<li><p>This configuration results in an absolute maximum distance from any household to its assigned Little Free Library of <code class="docutils literal notranslate"><span class="pre">1024.6229184980525</span></code> meters, which is slightly more than the <code class="docutils literal notranslate"><span class="pre">1000.0</span></code> meter maximum distance stipulation put forth by the committee. Dr. Minimax believes this to be the most equitable and feasible solution for the residents of Neighbor X. However…, the Neighborhood X Planning Committee turned out to be corrupt and merely chose locations for the Little Free Libraries
nearest to their respective houses….</p></li>
</ul>
</div>
</div>
<p><strong>The open (selected) Little Free Library Locations.</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">facilities</span><span class="p">[</span><span class="n">facilities</span><span class="p">[</span><span class="s2">&quot;pcp_sol&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;closed&quot;</span><span class="p">][[</span><span class="s2">&quot;dv&quot;</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dv</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>y[1]</td>
      <td>POINT (220941.277 268236.416)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>y[3]</td>
      <td>POINT (221048.278 267219.021)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>y[6]</td>
      <td>POINT (222006.585 267792.100)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Which-model-do-you-think-would-suit-the-community's-needs-best?">
<h2>Which model do you think would suit the community’s needs best?<a class="headerlink" href="#Which-model-do-you-think-would-suit-the-community's-needs-best?" title="Link to this heading">¶</a></h2>
<hr class="docutils" />
</section>
</section>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/notebooks/facility-location.ipynb.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2017-, pysal developers.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.3.7.<br/>
    </p>
  </div>
</footer>
  </body>
</html>